"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const util_1 = require("util");
const jimp_1 = __importDefault(require("jimp"));
const base_1 = __importDefault(require("./base"));
const request_api_1 = __importDefault(require("../utils/request-api"));
const create_browserstack_status_1 = __importDefault(require("../utils/create-browserstack-status"));
const get_api_polling_interval_1 = __importDefault(require("../utils/get-api-polling-interval"));
const ERROR_MESSAGES = __importStar(require("../templates/error-messages"));
const API_POLLING_INTERVAL = get_api_polling_interval_1.default();
const BROWSERSTACK_API_PATHS = {
    browserList: {
        url: 'https://api.browserstack.com/automate/browsers.json'
    },
    newSession: {
        url: 'https://hub-cloud.browserstack.com/wd/hub/session',
        method: 'POST'
    },
    openUrl: id => ({
        url: `https://hub-cloud.browserstack.com/wd/hub/session/${id}/url`,
        method: 'POST'
    }),
    getWindowSize: id => ({
        url: `https://hub-cloud.browserstack.com/wd/hub/session/${id}/window/current/size`
    }),
    setWindowSize: id => ({
        url: `https://hub-cloud.browserstack.com/wd/hub/session/${id}/window/current/size`,
        method: 'POST'
    }),
    maximizeWindow: id => ({
        url: `https://hub-cloud.browserstack.com/wd/hub/session/${id}/window/current/maximize`,
        method: 'POST'
    }),
    getUrl: id => ({
        url: `https://hub-cloud.browserstack.com/wd/hub/session/${id}/url`
    }),
    deleteSession: id => ({
        url: `https://hub-cloud.browserstack.com/wd/hub/session/${id}`,
        method: 'DELETE'
    }),
    screenshot: id => ({
        url: `https://hub-cloud.browserstack.com/wd/hub/session/${id}/screenshot`
    }),
    getStatus: id => ({
        url: `https://api.browserstack.com/automate/sessions/${id}.json`
    }),
    setStatus: id => ({
        url: `https://api.browserstack.com/automate/sessions/${id}.json`,
        method: 'PUT'
    })
};
function requestApi(path, params) {
    return request_api_1.default(path, params)
        .then(response => {
        if (response.status) {
            throw new Error(ERROR_MESSAGES.REMOTE_API_REQUEST_FAILED({
                status: response.status,
                apiResponse: response.value && response.value.message || util_1.inspect(response)
            }));
        }
        return response;
    });
}
function getCorrectedSize(currentClientAreaSize, currentWindowSize, requestedSize) {
    var horizontalChrome = currentWindowSize.width - currentClientAreaSize.width;
    var verticalChrome = currentWindowSize.height - currentClientAreaSize.height;
    return {
        width: requestedSize.width + horizontalChrome,
        height: requestedSize.height + verticalChrome
    };
}
class AutomateBackend extends base_1.default {
    constructor(...args) {
        super(...args);
        this.sessions = {};
    }
    static _ensureSessionId(sessionInfo) {
        const sessionData = sessionInfo.value || {};
        const sessionCapabilities = sessionData.capabilities || {};
        sessionInfo.sessionId = sessionInfo.sessionId ||
            sessionData.sessionId ||
            sessionData['webdriver.remote.sessionid'] ||
            sessionCapabilities['webdriver.remote.sessionid'];
        if (!sessionInfo.sessionId) {
            throw new Error(ERROR_MESSAGES.SESSION_ID_NOT_FOUND({
                sessionInfoDump: util_1.inspect(sessionInfo)
            }));
        }
    }
    async _requestSessionUrl(id) {
        var sessionInfo = await request_api_1.default(BROWSERSTACK_API_PATHS.getStatus(this.sessions[id].sessionId));
        return sessionInfo['automation_session']['browser_url'];
    }
    async _requestCurrentWindowSize(id) {
        var currentWindowSizeData = await requestApi(BROWSERSTACK_API_PATHS.getWindowSize(this.sessions[id].sessionId));
        return {
            width: currentWindowSizeData.value.width,
            height: currentWindowSizeData.value.height
        };
    }
    async getBrowsersList() {
        var platformsInfo = await request_api_1.default(BROWSERSTACK_API_PATHS.browserList);
        return platformsInfo.reverse();
    }
    getSessionUrl(id) {
        return this.sessions[id] ? this.sessions[id].sessionUrl : '';
    }
    async openBrowser(id, pageUrl, capabilities) {
        var { localIdentifier, local } = capabilities, restCapabilities = __rest(capabilities, ["localIdentifier", "local"]);
        capabilities = Object.assign({ 'browserstack.localIdentifier': localIdentifier, 'browserstack.local': local }, restCapabilities);
        this.sessions[id] = await requestApi(BROWSERSTACK_API_PATHS.newSession, {
            body: { desiredCapabilities: capabilities },
            executeImmediately: true
        });
        AutomateBackend._ensureSessionId(this.sessions[id]);
        this.sessions[id].sessionUrl = await this._requestSessionUrl(id);
        var sessionId = this.sessions[id].sessionId;
        this.sessions[id].interval = setInterval(() => requestApi(BROWSERSTACK_API_PATHS.getUrl(sessionId), { executeImmediately: true }), API_POLLING_INTERVAL);
        await requestApi(BROWSERSTACK_API_PATHS.openUrl(sessionId), { body: { url: pageUrl } });
    }
    async closeBrowser(id) {
        const session = this.sessions[id];
        if (!session)
            return;
        clearInterval(session.interval);
        delete this.sessions[id];
        // Delete session whose sessionId is created
        if (session.sessionId && session.sessionId !== '')
            await requestApi(BROWSERSTACK_API_PATHS.deleteSession(session.sessionId));
    }
    async takeScreenshot(id, screenshotPath) {
        var base64Data = await requestApi(BROWSERSTACK_API_PATHS.screenshot(this.sessions[id].sessionId));
        var buffer = Buffer.from(base64Data.value, 'base64');
        const image = await jimp_1.default.read(buffer);
        await image.write(screenshotPath);
    }
    async resizeWindow(id, width, height, currentWidth, currentHeight) {
        var sessionId = this.sessions[id].sessionId;
        var currentWindowSize = await this._requestCurrentWindowSize(id);
        var currentClientAreaSize = { width: currentWidth, height: currentHeight };
        var requestedSize = { width, height };
        var correctedSize = getCorrectedSize(currentClientAreaSize, currentWindowSize, requestedSize);
        await requestApi(BROWSERSTACK_API_PATHS.setWindowSize(sessionId), { body: correctedSize });
    }
    async maximizeWindow(id) {
        await requestApi(BROWSERSTACK_API_PATHS.maximizeWindow(this.sessions[id].sessionId));
    }
    async reportJobResult(id, jobResult, jobData, possibleResults) {
        var sessionId = this.sessions[id].sessionId;
        var jobStatus = create_browserstack_status_1.default(jobResult, jobData, possibleResults);
        await request_api_1.default(BROWSERSTACK_API_PATHS.setStatus(sessionId), { body: jobStatus });
    }
}
exports.default = AutomateBackend;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0b21hdGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvYmFja2VuZHMvYXV0b21hdGUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwrQkFBK0I7QUFDL0IsZ0RBQXdCO0FBQ3hCLGtEQUFpQztBQUNqQyx1RUFBa0Q7QUFDbEQscUdBQTJFO0FBQzNFLGlHQUFzRTtBQUN0RSw0RUFBOEQ7QUFHOUQsTUFBTSxvQkFBb0IsR0FBRyxrQ0FBcUIsRUFBRSxDQUFDO0FBRXJELE1BQU0sc0JBQXNCLEdBQUc7SUFDM0IsV0FBVyxFQUFFO1FBQ1QsR0FBRyxFQUFFLHFEQUFxRDtLQUM3RDtJQUVELFVBQVUsRUFBRTtRQUNSLEdBQUcsRUFBSyxtREFBbUQ7UUFDM0QsTUFBTSxFQUFFLE1BQU07S0FDakI7SUFFRCxPQUFPLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ1osR0FBRyxFQUFLLHFEQUFxRCxFQUFFLE1BQU07UUFDckUsTUFBTSxFQUFFLE1BQU07S0FDakIsQ0FBQztJQUVGLGFBQWEsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDbEIsR0FBRyxFQUFFLHFEQUFxRCxFQUFFLHNCQUFzQjtLQUNyRixDQUFDO0lBRUYsYUFBYSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNsQixHQUFHLEVBQUsscURBQXFELEVBQUUsc0JBQXNCO1FBQ3JGLE1BQU0sRUFBRSxNQUFNO0tBQ2pCLENBQUM7SUFFRixjQUFjLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ25CLEdBQUcsRUFBSyxxREFBcUQsRUFBRSwwQkFBMEI7UUFDekYsTUFBTSxFQUFFLE1BQU07S0FDakIsQ0FBQztJQUVGLE1BQU0sRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDWCxHQUFHLEVBQUUscURBQXFELEVBQUUsTUFBTTtLQUNyRSxDQUFD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QUFFLEVBQUU7UUFDcEIsTUFBTSxVQUFVLENBQUMsc0JBQXNCLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztJQUN6RixDQUFDO0lBRUQsS0FBSyxDQUFDLGVBQWUsQ0FBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxlQUFlO1FBQzFELElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDO1FBQzVDLElBQUksU0FBUyxHQUFHLG9DQUF3QixDQUFDLFNBQVMsRUFBRSxPQUFPLEVBQUUsZUFBZSxDQUFDLENBQUM7UUFFOUUsTUFBTSxxQkFBYyxDQUFDLHNCQUFzQixDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDO0lBQzNGLENBQUM7Q0FDSjtBQXRIRCxrQ0FzSEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbnNwZWN0IH0gZnJvbSAndXRpbCc7XHJcbmltcG9ydCBqaW1wIGZyb20gJ2ppbXAnO1xyXG5pbXBvcnQgQmFzZUJhY2tlbmQgZnJvbSAnLi9iYXNlJztcclxuaW1wb3J0IHJlcXVlc3RBcGlCYXNlIGZyb20gJy4uL3V0aWxzL3JlcXVlc3QtYXBpJztcclxuaW1wb3J0IGNyZWF0ZUJyb3dzZXJzdGFja1N0YXR1cyBmcm9tICcuLi91dGlscy9jcmVhdGUtYnJvd3NlcnN0YWNrLXN0YXR1cyc7XHJcbmltcG9ydCBnZXRBUElQb2xsaW5nSW50ZXJ2YWwgZnJvbSAnLi4vdXRpbHMvZ2V0LWFwaS1wb2xsaW5nLWludGVydmFsJztcclxuaW1wb3J0ICogYXMgRVJST1JfTUVTU0FHRVMgZnJvbSAnLi4vdGVtcGxhdGVzL2Vycm9yLW1lc3NhZ2VzJztcclxuXHJcblxyXG5jb25zdCBBUElfUE9MTElOR19JTlRFUlZBTCA9IGdldEFQSVBvbGxpbmdJbnRlcnZhbCgpO1xyXG5cclxuY29uc3QgQlJPV1NFUlNUQUNLX0FQSV9QQVRIUyA9IHtcclxuICAgIGJyb3dzZXJMaXN0OiB7XHJcbiAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGkuYnJvd3NlcnN0YWNrLmNvbS9hdXRvbWF0ZS9icm93c2Vycy5qc29uJ1xyXG4gICAgfSxcclxuXHJcbiAgICBuZXdTZXNzaW9uOiB7XHJcbiAgICAgICAgdXJsOiAgICAnaHR0cHM6Ly9odWItY2xvdWQuYnJvd3NlcnN0YWNrLmNvbS93ZC9odWIvc2Vzc2lvbicsXHJcbiAgICAgICAgbWV0aG9kOiAnUE9TVCdcclxuICAgIH0sXHJcblxyXG4gICAgb3BlblVybDogaWQgPT4gKHtcclxuICAgICAgICB1cmw6ICAgIGBodHRwczovL2h1Yi1jbG91ZC5icm93c2Vyc3RhY2suY29tL3dkL2h1Yi9zZXNzaW9uLyR7aWR9L3VybGAsXHJcbiAgICAgICAgbWV0aG9kOiAnUE9TVCdcclxuICAgIH0pLFxyXG5cclxuICAgIGdldFdpbmRvd1NpemU6IGlkID0+ICh7XHJcbiAgICAgICAgdXJsOiBgaHR0cHM6Ly9odWItY2xvdWQuYnJvd3NlcnN0YWNrLmNvbS93ZC9odWIvc2Vzc2lvbi8ke2lkfS93aW5kb3cvY3VycmVudC9zaXplYFxyXG4gICAgfSksXHJcblxyXG4gICAgc2V0V2luZG93U2l6ZTogaWQgPT4gKHtcclxuICAgICAgICB1cmw6ICAgIGBodHRwczovL2h1Yi1jbG91ZC5icm93c2Vyc3RhY2suY29tL3dkL2h1Yi9zZXNzaW9uLyR7aWR9L3dpbmRvdy9jdXJyZW50L3NpemVgLFxyXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnXHJcbiAgICB9KSxcclxuXHJcbiAgICBtYXhpbWl6ZVdpbmRvdzogaWQgPT4gKHtcclxuICAgICAgICB1cmw6ICAgIGBodHRwczovL2h1Yi1jbG91ZC5icm93c2Vyc3RhY2suY29tL3dkL2h1Yi9zZXNzaW9uLyR7aWR9L3dpbmRvdy9jdXJyZW50L21heGltaXplYCxcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJ1xyXG4gICAgfSksXHJcblxyXG4gICAgZ2V0VXJsOiBpZCA9PiAoe1xyXG4gICAgICAgIHVybDogYGh0dHBzOi8vaHViLWNsb3VkLmJyb3dzZXJzdGFjay5jb20vd2QvaHViL3Nlc3Npb24vJHtpZH0vdXJsYFxyXG4gICAgfSksXHJcblxyXG4gICAgZGVsZXRlU2Vzc2lvbjogaWQgPT4gKHtcclxuICAgICAgICB1cmw6ICAgIGBodHRwczovL2h1Yi1jbG91ZC5icm93c2Vyc3RhY2suY29tL3dkL2h1Yi9zZXNzaW9uLyR7aWR9YCxcclxuICAgICAgICBtZXRob2Q6ICdERUxFVEUnXHJcbiAgICB9KSxcclxuXHJcbiAgICBzY3JlZW5zaG90OiBpZCA9PiAoe1xyXG4gICAgICAgIHVybDogYGh0dHBzOi8vaHViLWNsb3VkLmJyb3dzZXJzdGFjay5jb20vd2QvaHViL3Nlc3Npb24vJHtpZH0vc2NyZWVuc2hvdGBcclxuICAgIH0pLFxyXG5cclxuICAgIGdldFN0YXR1czogaWQgPT4gKHtcclxuICAgICAgICB1cmw6IGBodHRwczovL2FwaS5icm93c2Vyc3RhY2suY29tL2F1dG9tYXRlL3Nlc3Npb25zLyR7aWR9Lmpzb25gXHJcbiAgICB9KSxcclxuXHJcbiAgICBzZXRTdGF0dXM6IGlkID0+ICh7XHJcbiAgICAgICAgdXJsOiAgICBgaHR0cHM6Ly9hcGkuYnJvd3NlcnN0YWNrLmNvbS9hdXRvbWF0ZS9zZXNzaW9ucy8ke2lkfS5qc29uYCxcclxuICAgICAgICBtZXRob2Q6ICdQVVQnXHJcbiAgICB9KVxyXG59O1xyXG5cclxuXHJcbmZ1bmN0aW9uIHJlcXVlc3RBcGkgKHBhdGgsIHBhcmFtcykge1xyXG4gICAgcmV0dXJuIHJlcXVlc3RBcGlCYXNlKHBhdGgsIHBhcmFtcylcclxuICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5SRU1PVEVfQVBJX1JFUVVFU1RfRkFJTEVEKHtcclxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICAgICAgcmVzcG9uc2Uuc3RhdHVzLFxyXG4gICAgICAgICAgICAgICAgICAgIGFwaVJlc3BvbnNlOiByZXNwb25zZS52YWx1ZSAmJiByZXNwb25zZS52YWx1ZS5tZXNzYWdlIHx8IGluc3BlY3QocmVzcG9uc2UpXHJcbiAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgICAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0Q29ycmVjdGVkU2l6ZSAoY3VycmVudENsaWVudEFyZWFTaXplLCBjdXJyZW50V2luZG93U2l6ZSwgcmVxdWVzdGVkU2l6ZSkge1xyXG4gICAgdmFyIGhvcml6b250YWxDaHJvbWUgPSBjdXJyZW50V2luZG93U2l6ZS53aWR0aCAtIGN1cnJlbnRDbGllbnRBcmVhU2l6ZS53aWR0aDtcclxuICAgIHZhciB2ZXJ0aWNhbENocm9tZSAgID0gY3VycmVudFdpbmRvd1NpemUuaGVpZ2h0IC0gY3VycmVudENsaWVudEFyZWFTaXplLmhlaWdodDtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHdpZHRoOiAgcmVxdWVzdGVkU2l6ZS53aWR0aCArIGhvcml6b250YWxDaHJvbWUsXHJcbiAgICAgICAgaGVpZ2h0OiByZXF1ZXN0ZWRTaXplLmhlaWdodCArIHZlcnRpY2FsQ2hyb21lXHJcbiAgICB9O1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBdXRvbWF0ZUJhY2tlbmQgZXh0ZW5kcyBCYXNlQmFja2VuZCB7XHJcbiAgICBjb25zdHJ1Y3RvciAoLi4uYXJncykge1xyXG4gICAgICAgIHN1cGVyKC4uLmFyZ3MpO1xyXG5cclxuICAgICAgICB0aGlzLnNlc3Npb25zID0ge307XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIF9lbnN1cmVTZXNzaW9uSWQgKHNlc3Npb25JbmZvKSB7XHJcbiAgICAgICAgY29uc3Qgc2Vzc2lvbkRhdGEgICAgICAgICA9IHNlc3Npb25JbmZvLnZhbHVlIHx8IHt9O1xyXG4gICAgICAgIGNvbnN0IHNlc3Npb25DYXBhYmlsaXRpZXMgPSBzZXNzaW9uRGF0YS5jYXBhYmlsaXRpZXMgfHwge307XHJcblxyXG4gICAgICAgIHNlc3Npb25JbmZvLnNlc3Npb25JZCA9IHNlc3Npb25JbmZvLnNlc3Npb25JZCB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25EYXRhLnNlc3Npb25JZCB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25EYXRhWyd3ZWJkcml2ZXIucmVtb3RlLnNlc3Npb25pZCddIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbkNhcGFiaWxpdGllc1snd2ViZHJpdmVyLnJlbW90ZS5zZXNzaW9uaWQnXTtcclxuXHJcbiAgICAgICAgaWYgKCFzZXNzaW9uSW5mby5zZXNzaW9uSWQpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKEVSUk9SX01FU1NBR0VTLlNFU1NJT05fSURfTk9UX0ZPVU5EKHtcclxuICAgICAgICAgICAgICAgIHNlc3Npb25JbmZvRHVtcDogaW5zcGVjdChzZXNzaW9uSW5mbylcclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBfcmVxdWVzdFNlc3Npb25VcmwgKGlkKSB7XHJcbiAgICAgICAgdmFyIHNlc3Npb25JbmZvID0gYXdhaXQgcmVxdWVzdEFwaUJhc2UoQlJPV1NFUlNUQUNLX0FQSV9QQVRIUy5nZXRTdGF0dXModGhpcy5zZXNzaW9uc1tpZF0uc2Vzc2lvbklkKSk7XHJcblxyXG4gICAgICAgIHJldHVybiBzZXNzaW9uSW5mb1snYXV0b21hdGlvbl9zZXNzaW9uJ11bJ2Jyb3dzZXJfdXJsJ107XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgX3JlcXVlc3RDdXJyZW50V2luZG93U2l6ZSAoaWQpIHtcclxuICAgICAgICB2YXIgY3VycmVudFdpbmRvd1NpemVEYXRhID0gYXdhaXQgcmVxdWVzdEFwaShCUk9XU0VSU1RBQ0tfQVBJX1BBVEhTLmdldFdpbmRvd1NpemUodGhpcy5zZXNzaW9uc1tpZF0uc2Vzc2lvbklkKSk7XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHdpZHRoOiAgY3VycmVudFdpbmRvd1NpemVEYXRhLnZhbHVlLndpZHRoLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IGN1cnJlbnRXaW5kb3dTaXplRGF0YS52YWx1ZS5oZWlnaHRcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIGdldEJyb3dzZXJzTGlzdCAoKSB7XHJcbiAgICAgICAgdmFyIHBsYXRmb3Jtc0luZm8gPSBhd2FpdCByZXF1ZXN0QXBpQmFzZShCUk9XU0VSU1RBQ0tfQVBJX1BBVEhTLmJyb3dzZXJMaXN0KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHBsYXRmb3Jtc0luZm8ucmV2ZXJzZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFNlc3Npb25VcmwgKGlkKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2Vzc2lvbnNbaWRdID8gdGhpcy5zZXNzaW9uc1tpZF0uc2Vzc2lvblVybCA6ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIG9wZW5Ccm93c2VyIChpZCwgcGFnZVVybCwgY2FwYWJpbGl0aWVzKSB7XHJcbiAgICAgICAgdmFyIHsgbG9jYWxJZGVudGlmaWVyLCBsb2NhbCwgLi4ucmVzdENhcGFiaWxpdGllcyB9ID0gY2FwYWJpbGl0aWVzO1xyXG5cclxuICAgICAgICBjYXBhYmlsaXRpZXMgPSB7XHJcbiAgICAgICAgICAgICdicm93c2Vyc3RhY2subG9jYWxJZGVudGlmaWVyJzogbG9jYWxJZGVudGlmaWVyLFxyXG4gICAgICAgICAgICAnYnJvd3NlcnN0YWNrLmxvY2FsJzogICAgICAgICAgIGxvY2FsLFxyXG4gICAgICAgICAgICAuLi5yZXN0Q2FwYWJpbGl0aWVzXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5zZXNzaW9uc1tpZF0gPSBhd2FpdCByZXF1ZXN0QXBpKEJST1dTRVJTVEFDS19BUElfUEFUSFMubmV3U2Vzc2lvbiwge1xyXG4gICAgICAgICAgICBib2R5OiB7IGRlc2lyZWRDYXBhYmlsaXRpZXM6IGNhcGFiaWxpdGllcyB9LFxyXG5cclxuICAgICAgICAgICAgZXhlY3V0ZUltbWVkaWF0ZWx5OiB0cnVlXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIEF1dG9tYXRlQmFja2VuZC5fZW5zdXJlU2Vzc2lvbklkKHRoaXMuc2Vzc2lvbnNbaWRdKTtcclxuXHJcbiAgICAgICAgdGhpcy5zZXNzaW9uc1tpZF0uc2Vzc2lvblVybCA9IGF3YWl0IHRoaXMuX3JlcXVlc3RTZXNzaW9uVXJsKGlkKTtcclxuXHJcbiAgICAgICAgdmFyIHNlc3Npb25JZCA9IHRoaXMuc2Vzc2lvbnNbaWRdLnNlc3Npb25JZDtcclxuXHJcbiAgICAgICAgdGhpcy5zZXNzaW9uc1tpZF0uaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiByZXF1ZXN0QXBpKEJST1dTRVJTVEFDS19BUElfUEFUSFMuZ2V0VXJsKHNlc3Npb25JZCksIHsgZXhlY3V0ZUltbWVkaWF0ZWx5OiB0cnVlIH0pLCBBUElfUE9MTElOR19JTlRFUlZBTCk7XHJcblxyXG4gICAgICAgIGF3YWl0IHJlcXVlc3RBcGkoQlJPV1NFUlNUQUNLX0FQSV9QQVRIUy5vcGVuVXJsKHNlc3Npb25JZCksIHsgYm9keTogeyB1cmw6IHBhZ2VVcmwgfSB9KTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBjbG9zZUJyb3dzZXIgKGlkKSB7XHJcbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IHRoaXMuc2Vzc2lvbnNbaWRdO1xyXG5cclxuICAgICAgICBpZiAoIXNlc3Npb24pXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgY2xlYXJJbnRlcnZhbChzZXNzaW9uLmludGVydmFsKTtcclxuXHJcbiAgICAgICAgZGVsZXRlIHRoaXMuc2Vzc2lvbnNbaWRdO1xyXG5cclxuICAgICAgICAvLyBEZWxldGUgc2Vzc2lvbiB3aG9zZSBzZXNzaW9uSWQgaXMgY3JlYXRlZFxyXG4gICAgICAgIGlmIChzZXNzaW9uLnNlc3Npb25JZCAmJiBzZXNzaW9uLnNlc3Npb25JZCAhPT0gJycpXHJcbiAgICAgICAgICAgIGF3YWl0IHJlcXVlc3RBcGkoQlJPV1NFUlNUQUNLX0FQSV9QQVRIUy5kZWxldGVTZXNzaW9uKHNlc3Npb24uc2Vzc2lvbklkKSk7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgdGFrZVNjcmVlbnNob3QgKGlkLCBzY3JlZW5zaG90UGF0aCkge1xyXG4gICAgICAgIHZhciBiYXNlNjREYXRhID0gYXdhaXQgcmVxdWVzdEFwaShCUk9XU0VSU1RBQ0tfQVBJX1BBVEhTLnNjcmVlbnNob3QodGhpcy5zZXNzaW9uc1tpZF0uc2Vzc2lvbklkKSk7XHJcbiAgICAgICAgdmFyIGJ1ZmZlciAgICAgPSBCdWZmZXIuZnJvbShiYXNlNjREYXRhLnZhbHVlLCAnYmFzZTY0Jyk7XHJcblxyXG4gICAgICAgIGNvbnN0IGltYWdlID0gYXdhaXQgamltcC5yZWFkKGJ1ZmZlcik7XHJcblxyXG4gICAgICAgIGF3YWl0IGltYWdlLndyaXRlKHNjcmVlbnNob3RQYXRoKTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyByZXNpemVXaW5kb3cgKGlkLCB3aWR0aCwgaGVpZ2h0LCBjdXJyZW50V2lkdGgsIGN1cnJlbnRIZWlnaHQpIHtcclxuICAgICAgICB2YXIgc2Vzc2lvbklkICAgICAgICAgICAgID0gdGhpcy5zZXNzaW9uc1tpZF0uc2Vzc2lvbklkO1xyXG4gICAgICAgIHZhciBjdXJyZW50V2luZG93U2l6ZSAgICAgPSBhd2FpdCB0aGlzLl9yZXF1ZXN0Q3VycmVudFdpbmRvd1NpemUoaWQpO1xyXG4gICAgICAgIHZhciBjdXJyZW50Q2xpZW50QXJlYVNpemUgPSB7IHdpZHRoOiBjdXJyZW50V2lkdGgsIGhlaWdodDogY3VycmVudEhlaWdodCB9O1xyXG4gICAgICAgIHZhciByZXF1ZXN0ZWRTaXplICAgICAgICAgPSB7IHdpZHRoLCBoZWlnaHQgfTtcclxuICAgICAgICB2YXIgY29ycmVjdGVkU2l6ZSAgICAgICAgID0gZ2V0Q29ycmVjdGVkU2l6ZShjdXJyZW50Q2xpZW50QXJlYVNpemUsIGN1cnJlbnRXaW5kb3dTaXplLCByZXF1ZXN0ZWRTaXplKTtcclxuXHJcbiAgICAgICAgYXdhaXQgcmVxdWVzdEFwaShCUk9XU0VSU1RBQ0tfQVBJX1BBVEhTLnNldFdpbmRvd1NpemUoc2Vzc2lvbklkKSwgeyBib2R5OiBjb3JyZWN0ZWRTaXplIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIG1heGltaXplV2luZG93IChpZCkge1xyXG4gICAgICAgIGF3YWl0IHJlcXVlc3RBcGkoQlJPV1NFUlNUQUNLX0FQSV9QQVRIUy5tYXhpbWl6ZVdpbmRvdyh0aGlzLnNlc3Npb25zW2lkXS5zZXNzaW9uSWQpKTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyByZXBvcnRKb2JSZXN1bHQgKGlkLCBqb2JSZXN1bHQsIGpvYkRhdGEsIHBvc3NpYmxlUmVzdWx0cykge1xyXG4gICAgICAgIHZhciBzZXNzaW9uSWQgPSB0aGlzLnNlc3Npb25zW2lkXS5zZXNzaW9uSWQ7XHJcbiAgICAgICAgdmFyIGpvYlN0YXR1cyA9IGNyZWF0ZUJyb3dzZXJzdGFja1N0YXR1cyhqb2JSZXN1bHQsIGpvYkRhdGEsIHBvc3NpYmxlUmVzdWx0cyk7XHJcblxyXG4gICAgICAgIGF3YWl0IHJlcXVlc3RBcGlCYXNlKEJST1dTRVJTVEFDS19BUElfUEFUSFMuc2V0U3RhdHVzKHNlc3Npb25JZCksIHsgYm9keTogam9iU3RhdHVzIH0pO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==