!function a(b){var d=b.document;!function(e,f,g,h){var i="default"in e?e.default:e,j="default"in f?f.default:f,k=function(e,t){return(k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function l(e,t){function r(){this.constructor=e}k(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var s=Math.floor(399),u_ready="ready",u_readyForBrowserManipulation="ready-for-browser-manipulation",v={click:"click",rightClick:"right-click",doubleClick:"double-click",drag:"drag",dragToElement:"drag-to-element",hover:"hover",typeText:"type-text",selectText:"select-text",selectTextAreaContent:"select-text-area-content",selectEditableContent:"select-editable-content",pressKey:"press-key",wait:"wait",navigateTo:"navigate-to",setFilesToUpload:"set-files-to-upload",clearUpload:"clear-upload",executeClientFunction:"execute-client-function",executeSelector:"execute-selector",takeScreenshot:"take-screenshot",takeElementScreenshot:"take-element-screenshot",takeScreenshotOnFail:"take-screenshot-on-fail",prepareBrowserManipulation:"prepare-browser-manipulation",showAssertionRetriesStatus:"show-assertion-retries-status",hideAssertionRetriesStatus:"hide-assertion-retries-status",setBreakpoint:"set-breakpoint",resizeWindow:"resize-window",resizeWindowToFitDevice:"resize-window-to-fit-device",maximizeWindow:"maximize-window",switchToIframe:"switch-to-iframe",switchToMainWindow:"switch-to-main-window",setNativeDialogHandler:"set-native-dialog-handler",getNativeDialogHistory:"get-native-dialog-history",getBrowserConsoleMessages:"get-browser-console-messages",setTestSpeed:"set-test-speed",setPageLoadTimeout:"set-page-load-timeout",debug:"debug",assertion:"assertion",useRole:"useRole",testDone:"test-done",backupStorages:"backup-storages",executeExpression:"execute-expression",executeAsyncExpression:"execute-async-expression",unlockPage:"unlock-page",recorder:"recorder"};function w(e){return!(function(e){return e.type===v.executeClientFunction||e.type===v.executeSelector}(n=e)||n.type===v.wait||n.type===v.assertion||n.type===v.executeExpression||C(e)||(r=e).type===v.testDone||r.type===v.showAssertionRetriesStatus||r.type===v.hideAssertionRetriesStatus||r.type===v.setBreakpoint||r.type===v.takeScreenshotOnFail||r.type===v.recorder)||B(e)&&!((t=e).type===v.switchToIframe||t.type===v.switchToMainWindow);var t,r,n}function B(e){return e.type===v.resizeWindow||e.type===v.resizeWindowToFitDevice||e.type===v.maximizeWindow}function C(e){return(t=e).type===v.takeScreenshot||t.type===v.takeElementScreenshot||t.type===v.takeScreenshotOnFail||B(e);var t}function G(e){this.code=e,this.isTestCafeError=!0,this.callsite=null}var De,F_uncaughtErrorOnPage="E1",F_uncaughtErrorInTestCode="E2",F_uncaughtNonErrorObjectInTestCode="E3",F_uncaughtErrorInClientFunctionCode="E4",F_uncaughtErrorInCustomDOMPropertyCode="E5",F_unhandledPromiseRejection="E6",F_uncaughtException="E7",F_missingAwaitError="E8",F_actionIntegerOptionError="E9",F_actionPositiveIntegerOptionError="E10",F_actionBooleanOptionError="E11",F_actionSpeedOptionError="E12",F_actionOptionsTypeError="E14",F_actionBooleanArgumentError="E15",F_actionStringArgumentError="E16",F_actionNullableStringArgumentError="E17",F_actionStringOrStringArrayArgumentError="E18",F_actionStringArrayElementError="E19",F_actionIntegerArgumentError="E20",F_actionRoleArgumentError="E21",F_actionPositiveIntegerArgumentError="E22",F_actionSelectorError="E23",F_actionElementNotFoundError="E24",F_actionElementIsInvisibleError="E26",F_actionSelectorMatchesWrongNodeTypeError="E27",F_actionAdditionalElementNotFoundError="E28",F_actionAdditionalElementIsInvisibleError="E29",F_actionAdditionalSelectorMatchesWrongNodeTypeError="E30",F_actionElementNonEditableError="E31",F_actionElementNotTextAreaError="E32",F_actionElementNonContentEditableError="E33",F_actionElementIsNotFileInputError="E34",F_actionRootContainerNotFoundError="E35",F_actionIncorrectKeysError="E36",F_actionCannotFindFileToUploadError="E37",F_actionUnsupportedDeviceTypeError="E38",F_actionIframeIsNotLoadedError="E39",F_actionElementNotIframeError="E40",F_actionInvalidScrollTargetError="E41",F_currentIframeIsNotLoadedError="E42",F_currentIframeNotFoundError="E43",F_currentIframeIsInvisibleError="E44",F_nativeDialogNotHandledError="E45",F_uncaughtErrorInNativeDialogHandler="E46",F_setTestSpeedArgumentError="E47",F_setNativeDialogHandlerCodeWrongTypeError="E48",F_clientFunctionExecutionInterruptionError="E49",F_domNodeClientFunctionResultError="E50",F_invalidSelectorResultError="E51",F_cannotObtainInfoForElementSpecifiedBySelectorError="E52",F_externalAssertionLibraryError="E53",F_pageLoadError="E54",F_windowDimensionsOverflowError="E55",F_forbiddenCharactersInScreenshotPathError="E56",F_invalidElementScreenshotDimensionsError="E57",F_roleSwitchInRoleInitializerError="E58",F_assertionExecutableArgumentError="E59",F_assertionWithoutMethodCallError="E60",F_assertionUnawaitedPromiseError="E61",F_requestHookNotImplementedError="E62",F_requestHookUnhandledError="E63",F_uncaughtErrorInCustomClientScriptCode="E64",F_uncaughtErrorInCustomClientScriptCodeLoadedFromModule="E65",F_uncaughtErrorInCustomScript="E66",F_uncaughtTestCafeErrorInCustomScript="E67",F_childWindowIsNotLoadedError="E68",F_childWindowNotFoundError="E69",F_cannotSwitchToWindowError="E70",F_closeChildWindowError="E71",F_childWindowClosedBeforeSwitchingError="E72",H=(l(Ee,De=G),Ee);function Ee(e,t,r){var n=De.call(this,e)||this;return n.optionName=t,n.actualValue=r,n}var Je,Pe,I=(l(Ke,Je=G),Ke);function Ke(e,t,r){var n=Je.call(this,e)||this;return n.argumentName=t,n.actualValue=r,n}function Qe(e){var t=Pe.call(this,F_missingAwaitError)||this;return t.callsite=e,t}l(Qe,Pe=G);var Te,K=(l(Ue,Te=G),Ue);function Ue(e){var t=Te.call(this,F_clientFunctionExecutionInterruptionError)||this;return t.instantiationCallsiteName=e,t}var Xe,L=(l(Ye,Xe=G),Ye);function Ye(e){var t=Xe.call(this,F_domNodeClientFunctionResultError)||this;return t.instantiationCallsiteName=e,t}var _e,M=(l(af,_e=G),af);function af(e,t){var r=t.apiFnChain,n=t.apiFnIndex,i=_e.call(this,e)||this;return i.apiFnChain=r,i.apiFnIndex=n,i}var gf,N=(l(hf,gf=G),hf);function hf(){return gf.call(this,F_invalidSelectorResultError)||this}var jf,of,O=(l(kf,jf=M),kf);function kf(e,t){var r=jf.call(this,F_cannotObtainInfoForElementSpecifiedBySelectorError,t)||this;return r.callsite=e,r}function pf(e,t){var r=of.call(this,F_pageLoadError)||this;return r.url=t,r.errMsg=e,r}l(pf,of=G);var tf,yf,Df,Q=(l(uf,tf=G),uf);function uf(e,t){var r=tf.call(this,F_uncaughtErrorOnPage)||this;return r.errStack=e,r.pageDestUrl=t,r}function zf(e,t){var r=yf.call(this,F_uncaughtErrorInTestCode)||this;return r.errMsg=String(e.rawMessage||e),r.callsite=e.callsite||t,r.originError=e,r}function Ef(e){var t=Df.call(this,F_uncaughtNonErrorObjectInTestCode)||this;return t.objType=typeof e,t.objStr=String(e),t}l(zf,yf=G),l(Ef,Df=G);var Hf,T=(l(If,Hf=G),If);function If(e,t){var r=Hf.call(this,F_uncaughtErrorInClientFunctionCode)||this;return r.errMsg=String(t),r.instantiationCallsiteName=e,r}var Mf,Sf,Wf,U=(l(Nf,Mf=G),Nf);function Nf(e,t,r){var n=Mf.call(this,F_uncaughtErrorInCustomDOMPropertyCode,t,r)||this;return n.errMsg=String(t),n.property=r,n.instantiationCallsiteName=e,n}function Tf(e){var t=Sf.call(this,F_unhandledPromiseRejection)||this;return t.errMsg=String(e),t}function Xf(e){var t=Wf.call(this,F_uncaughtException)||this;return t.errMsg=String(e),t}l(Tf,Sf=G),l(Xf,Wf=G);var $f,X=(l(_f,$f=G),_f);function _f(e){var t=$f.call(this,F_uncaughtErrorInCustomClientScriptCode)||this;return t.errMsg=String(e),t}var cg,hg,mg,tg,xg,Y=(l(dg,cg=G),dg);function dg(e,t){var r=cg.call(this,F_uncaughtErrorInCustomClientScriptCodeLoadedFromModule)||this;return r.errMsg=String(e),r.moduleName=t,r}function ig(e,t){var r=hg.call(this,F_externalAssertionLibraryError)||this;return r.errMsg=String(e),r.callsite=t,r}function ng(e,t,r,n){var i=mg.call(this,F_assertionExecutableArgumentError,e,t)||this;return i.errMsg=n?r.rawMessage:r.message,i.originError=r,i}function ug(e){var t=tg.call(this,F_assertionWithoutMethodCallError)||this;return t.callsite=e,t}function yg(e){var t=xg.call(this,F_assertionUnawaitedPromiseError)||this;return t.callsite=e,t}l(ig,hg=G),l(ng,mg=I),l(ug,tg=G),l(yg,xg=G);var Bg,ba=(l(Cg,Bg=H),Cg);function Cg(e,t){return Bg.call(this,F_actionIntegerOptionError,e,t)||this}var Fg,ca=(l(Gg,Fg=H),Gg);function Gg(e,t){return Fg.call(this,F_actionPositiveIntegerOptionError,e,t)||this}var Jg,Ng,da=(l(Kg,Jg=H),Kg);function Kg(e,t){return Jg.call(this,F_actionBooleanOptionError,e,t)||this}function Og(e,t){return Ng.call(this,F_actionBooleanArgumentError,e,t)||this}l(Og,Ng=I);var Rg,Vg,Zg,bh,fh,jh,nh,rh,vh,Bh,Fh,Jh,fa=(l(Sg,Rg=H),Sg);function Sg(e,t){return Rg.call(this,F_actionSpeedOptionError,e,t)||this}function Wg(e){var t=Vg.call(this,F_actionOptionsTypeError)||this;return t.actualType=e,t}function $g(e,t){return Zg.call(this,F_actionStringArgumentError,e,t)||this}function ch(e,t){return bh.call(this,F_actionNullableStringArgumentError,e,t)||this}function gh(e,t){return fh.call(this,F_actionIntegerArgumentError,e,t)||this}function kh(e,t){return jh.call(this,F_actionRoleArgumentError,e,t)||this}function oh(e,t){return nh.call(this,F_actionPositiveIntegerArgumentError,e,t)||this}function sh(e,t){return rh.call(this,F_actionStringOrStringArrayArgumentError,e,t)||this}function wh(e,t,r){var n=vh.call(this,F_actionStringArrayElementError,e,t)||this;return n.elementIndex=r,n}function Ch(e,t){return Bh.call(this,F_setTestSpeedArgumentError,e,t)||this}function Gh(e,t){return Fh.call(this,F_actionUnsupportedDeviceTypeError,e,t)||this}function Kh(e,t,r){var n=Jh.call(this,F_actionSelectorError)||this;return n.selectorName=e,n.errMsg=r?t.rawMessage:t.message,n.originError=t,n}l(Wg,Vg=G),l($g,Zg=I),l(ch,bh=I),l(gh,fh=I),l(kh,jh=I),l(oh,nh=I),l(sh,rh=I),l(wh,vh=I),l(Ch,Bh=I),l(Gh,Fh=I),l(Kh,Jh=G);var Ph,ra=(l(Qh,Ph=M),Qh);function Qh(e){return Ph.call(this,F_actionElementNotFoundError,e)||this}var Sh,sa=(l(Th,Sh=G),Th);function Th(){return Sh.call(this,F_actionElementIsInvisibleError)||this}var Uh,ta=(l(Vh,Uh=G),Vh);function Vh(e){var t=Uh.call(this,F_actionSelectorMatchesWrongNodeTypeError)||this;return t.nodeDescription=e,t}var Yh,ua=(l(Zh,Yh=M),Zh);function Zh(e,t){var r=Yh.call(this,F_actionAdditionalElementNotFoundError,t)||this;return r.argumentName=e,r}var bi,va=(l(ci,bi=G),ci);function ci(e){var t=bi.call(this,F_actionAdditionalElementIsInvisibleError)||this;return t.argumentName=e,t}var fi,wa=(l(gi,fi=G),gi);function gi(e,t){var r=fi.call(this,F_actionAdditionalSelectorMatchesWrongNodeTypeError)||this;return r.argumentName=e,r.nodeDescription=t,r}var ki,xa=(l(li,ki=G),li);function li(){return ki.call(this,F_actionElementNonEditableError)||this}var mi,ya=(l(ni,mi=G),ni);function ni(){return mi.call(this,F_actionElementNotTextAreaError)||this}var oi,za=(l(pi,oi=G),pi);function pi(e){var t=oi.call(this,F_actionElementNonContentEditableError)||this;return t.argumentName=e,t}var si,Aa=(l(ti,si=G),ti);function ti(){return si.call(this,F_actionRootContainerNotFoundError)||this}var ui,Ba=(l(vi,ui=G),vi);function vi(e){var t=ui.call(this,F_actionIncorrectKeysError)||this;return t.argumentName=e,t}var yi,Ca=(l(zi,yi=G),zi);function zi(e){var t=yi.call(this,F_actionCannotFindFileToUploadError)||this;return t.filePaths=e,t}var Ci,Da=(l(Di,Ci=G),Di);function Di(){return Ci.call(this,F_actionElementIsNotFileInputError)||this}var Ei,Ji,Ri,Zi,Ea=(l(Fi,Ei=G),Fi);function Fi(e,t){var r=Ei.call(this,F_actionInvalidScrollTargetError)||this;return r.properties=e?"scrollTargetY property":t?"scrollTargetX property":"scrollTargetX and scrollTargetY properties",r}function Ki(e,t,r,n,i){var o=Ji.call(this,F_uncaughtErrorInCustomScript)||this;return o.callsite=i,o.expression=t,o.line=r,o.column=n,o.originError=e,o.errMsg=e.message||String(e),o}function Si(e,t,r,n,i){var o=Ri.call(this,F_uncaughtTestCafeErrorInCustomScript)||this;return o.callsite=i,o.expression=t,o.line=r,o.column=n,o.originError=e,o.errCallsite=e.callsite,o}function $i(e){var t=Zi.call(this,F_windowDimensionsOverflowError)||this;return t.callsite=e,t}l(Ki,Ji=G),l(Si,Ri=G),l($i,Zi=G);var bj,ij,nj,Ia=(l(cj,bj=G),cj);function cj(e,t){var r=bj.call(this,F_invalidElementScreenshotDimensionsError)||this;return e<=0?t<=0?(r.verb="are",r.dimensions="width and height"):(r.verb="is",r.dimensions="width"):(r.verb="is",r.dimensions="height"),r}function jj(e,t){var r=ij.call(this,F_forbiddenCharactersInScreenshotPathError)||this;return r.screenshotPath=e,r.forbiddenCharsList=t,r}function oj(e){var t=nj.call(this,F_roleSwitchInRoleInitializerError)||this;return t.callsite=e,t}l(jj,ij=G),l(oj,nj=G);var rj,La=(l(sj,rj=G),sj);function sj(){return rj.call(this,F_actionElementNotIframeError)||this}var tj,Ma=(l(uj,tj=G),uj);function uj(){return tj.call(this,F_actionIframeIsNotLoadedError)||this}var vj,Na=(l(wj,vj=G),wj);function wj(){return vj.call(this,F_currentIframeIsNotLoadedError)||this}var xj,Oa=(l(yj,xj=G),yj);function yj(){return xj.call(this,F_childWindowNotFoundError)||this}var zj,Pa=(l(Aj,zj=G),Aj);function Aj(){return zj.call(this,F_childWindowIsNotLoadedError)||this}var Bj,Qa=(l(Cj,Bj=G),Cj);function Cj(){return Bj.call(this,F_cannotSwitchToWindowError)||this}var Dj,Ra=(l(Ej,Dj=G),Ej);function Ej(){return Dj.call(this,F_closeChildWindowError)||this}var Fj,Sa=(l(Gj,Fj=G),Gj);function Gj(){return Fj.call(this,F_currentIframeNotFoundError)||this}var Hj,Ta=(l(Ij,Hj=G),Ij);function Ij(){return Hj.call(this,F_currentIframeIsInvisibleError)||this}var Jj,Ua=(l(Kj,Jj=G),Kj);function Kj(e,t){var r=Jj.call(this,F_nativeDialogNotHandledError)||this;return r.dialogType=e,r.pageUrl=t,r}var Oj,Uj,Yj,ck,Va=(l(Pj,Oj=G),Pj);function Pj(e,t,r){var n=Oj.call(this,F_uncaughtErrorInNativeDialogHandler)||this;return n.dialogType=e,n.errMsg=t,n.pageUrl=r,n}function Vj(e){var t=Uj.call(this,F_setNativeDialogHandlerCodeWrongTypeError)||this;return t.actualType=e,t}function Zj(e,t,r){var n=Yj.call(this,F_requestHookUnhandledError)||this;return n.errMsg=String(e),n.hookClassName=t,n.methodName=r,n}function dk(e,t){var r=ck.call(this,F_requestHookNotImplementedError)||this;return r.methodName=e,r.hookClassName=t,r}l(Vj,Uj=G),l(Zj,Yj=G),l(dk,ck=G);var hk,Za=(l(ik,hk=G),ik);function ik(){return hk.call(this,F_childWindowClosedBeforeSwitchingError)||this}var $a=(jk.prototype.ensureMessageContainer=function(e){this[e]||(this[e]={log:[],info:[],warn:[],error:[]})},jk.prototype.concat=function(t){var r=this;return t&&Object.keys(t).forEach(function(e){r.ensureMessageContainer(e),r[e].log=r[e].log.concat(t[e].log),r[e].info=r[e].info.concat(t[e].info),r[e].warn=r[e].warn.concat(t[e].warn),r[e].error=r[e].error.concat(t[e].error)}),this},jk.prototype.addMessage=function(e,t,r){this.ensureMessageContainer(r),this[r][e].push(t)},jk.prototype.getCopy=function(){var t=this,r={};return Object.keys(this).forEach(function(e){r[e]={log:t[e].log.slice(),info:t[e].info.slice(),warn:t[e].warn.slice(),error:t[e].error.slice()}}),r},jk);function jk(e){this.concat(e)}var _a=(vk.prototype._getAssignableProperties=function(){throw new Error("Not implemented")},vk.prototype._assignFrom=function(e,t,r){if(void 0===r&&(r={}),e)for(var n=this._getAssignableProperties(),i=0;i<n.length;i++){for(var o=n[i],a=o.name,s=o.type,l=o.required,c=o.init,u=o.defaultValue,d=a.split("."),h=d.length-1,f=d[h],m=e,p=this,g=0;g<h&&m&&p;g++)m=m[d[g]],p=p[d[g]];if(p&&"defaultValue"in n[i]&&(p[a]=u),m&&p){var v=m[f];void 0===v&&!l||(t&&s&&s(a,v),p[f]=c?c(a,v,r):v)}}},vk);function vk(){}function ab(){return e.nativeMethods.performanceNow().toString()}var Ok,bb=(l(Pk,Ok=_a),Pk.prototype._getAssignableProperties=function(){return[{name:"isCommandResult"},{name:"executionError"},{name:"pageError"},{name:"result"},{name:"consoleMessages"},{name:"isPendingWindowSwitching"},{name:"isFirstRequestAfterWindowSwitching"}]},Pk);function Pk(e){var t=Ok.call(this,e)||this;return t.id=ab(),t.isCommandResult=!1,t.executionError=null,t.pageError=null,t.resent=!1,t.result=null,t.consoleMessages=null,t.isPendingWindowSwitching=!1,t.isFirstRequestAfterWindowSwitching=!1,t._assignFrom(e,!0),t}var Tk,db=(function(Uk){function dl(e,t){this.references=e,this.transforms=t,this.circularCandidates=[],this.circularCandidatesDescrs=[],this.circularRefCount=0}var Xk=/^#*@(t|r)$/,Yk=eval("this"),Zk="function"==typeof ArrayBuffer,$k="function"==typeof Map,_k="function"==typeof Set,al=["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"],bl=Array.prototype.slice,cl={serialize:function(e){return JSON.stringify(e)},deserialize:function(e){return JSON.parse(e)}};function el(e,t){this.references=e,this.transformMap=t,this.activeTransformsStack=[],this.visitedRefs=Object.create(null)}dl._createRefMark=function(e){var t=Object.create(null);return t["@r"]=e,t},dl.prototype._createCircularCandidate=function(e,t,r){this.circularCandidates.push(e),this.circularCandidatesDescrs.push({parent:t,key:r,refIdx:-1})},dl.prototype._applyTransform=function(e,t,r,n){var i=Object.create(null),o=n.toSerializable(e);return"object"==typeof o&&this._createCircularCandidate(e,t,r),i["@t"]=n.type,i.data=this._handleValue(o,t,r),i},dl.prototype._handleArray=function(e){for(var t=[],r=0;r<e.length;r++)t[r]=this._handleValue(e[r],t,r);return t},dl.prototype._handlePlainObject=function(r){var n=this,i=Object.create(null);return Object.getOwnPropertyNames(r).forEach(function(e){var t=Xk.test(e)?"#"+e:e;i[t]=n._handleValue(r[e],i,t)}),i},dl.prototype._handleObject=function(e,t,r){return this._createCircularCandidate(e,t,r),Array.isArray(e)?this._handleArray(e):this._handlePlainObject(e)},dl.prototype._ensureCircularReference=function(e){var t=this.circularCandidates.indexOf(e);if(-1<t){var r=this.circularCandidatesDescrs[t];return-1===r.refIdx&&(r.refIdx=r.parent?++this.circularRefCount:0),dl._createRefMark(r.refIdx)}return null},dl.prototype._handleValue=function(e,t,r){var n=typeof e,i="object"==n&&null!==e;if(i){var o=this._ensureCircularReference(e);if(o)return o}for(var a=0;a<this.transforms.length;a++){var s=this.transforms[a];if(s.shouldTransform(n,e))return this._applyTransform(e,t,r,s)}return i?this._handleObject(e,t,r):e},dl.prototype.transform=function(){for(var e=[this._handleValue(this.references,null,null)],t=0;t<this.circularCandidatesDescrs.length;t++){var r=this.circularCandidatesDescrs[t];0<r.refIdx&&(e[r.refIdx]=r.parent[r.key],r.parent[r.key]=dl._createRefMark(r.refIdx))}return e},el.prototype._handlePlainObject=function(t){var r=this,n=Object.create(null),e=Object.getOwnPropertyNames(t);for(var i in e.forEach(function(e){r._handleValue(t[e],t,e),Xk.test(e)&&(n[e.substring(1)]=t[e],delete t[e])}),n)t[i]=n[i]},el.prototype._handleTransformedObject=function(e,t,r){var n=e["@t"],i=this.transformMap[n];if(!i)throw new Error("Can't find transform for \""+n+'" type.');this.activeTransformsStack.push(e),this._handleValue(e.data,e,"data"),this.activeTransformsStack.pop(),t[r]=i.fromSerializable(e.data)},el.prototype._handleCircularSelfRefDuringTransform=function(e,t,r){var n=this.references,i=void 0;Object.defineProperty(t,r,{configurable:!0,enumerable:!0,get:function(){return void 0===i&&(i=n[e]),i},set:function(e){return i=e}})},el.prototype._handleCircularRef=function(e,t,r){-1<this.activeTransformsStack.indexOf(this.references[e])?this._handleCircularSelfRefDuringTransform(e,t,r):(this.visitedRefs[e]||(this.visitedRefs[e]=!0,this._handleValue(this.references[e],this.references,e)),t[r]=this.references[e])},el.prototype._handleValue=function(e,t,r){if("object"==typeof e&&null!==e){var n=e["@r"];if(void 0!==n)this._handleCircularRef(n,t,r);else if(e["@t"])this._handleTransformedObject(e,t,r);else if(Array.isArray(e))for(var i=0;i<e.length;i++)this._handleValue(e[i],e,i);else this._handlePlainObject(e)}},el.prototype.transform=function(){return this.visitedRefs[0]=!0,this._handleValue(this.references[0],this.references,0),this.references[0]};var fl=[{type:"[[NaN]]",shouldTransform:function(e,t){return"number"===e&&isNaN(t)},toSerializable:function(){return""},fromSerializable:function(){return NaN}},{type:"[[undefined]]",shouldTransform:function(e){return"undefined"===e},toSerializable:function(){return""},fromSerializable:function(){}},{type:"[[Date]]",shouldTransform:function(e,t){return t instanceof Date},toSerializable:function(e){return e.getTime()},fromSerializable:function(e){var t=new Date;return t.setTime(e),t}},{type:"[[RegExp]]",shouldTransform:function(e,t){return t instanceof RegExp},toSerializable:function(e){var t={src:e.source,flags:""};return e.global&&(t.flags+="g"),e.ignoreCase&&(t.flags+="i"),e.multiline&&(t.flags+="m"),t},fromSerializable:function(e){return new RegExp(e.src,e.flags)}},{type:"[[Error]]",shouldTransform:function(e,t){return t instanceof Error},toSerializable:function(e){return{name:e.name,message:e.message,stack:e.stack}},fromSerializable:function(e){var t=new(Yk[e.name]||Error)(e.message);return t.stack=e.stack,t}},{type:"[[ArrayBuffer]]",shouldTransform:function(e,t){return Zk&&t instanceof ArrayBuffer},toSerializable:function(e){var t=new Int8Array(e);return bl.call(t)},fromSerializable:function(e){if(Zk){var t=new ArrayBuffer(e.length);return new Int8Array(t).set(e),t}return e}},{type:"[[TypedArray]]",shouldTransform:function(e,t){for(var r=0;r<al.length;r++){var n=al[r];if("function"==typeof Yk[n]&&t instanceof Yk[n])return!0}return!1},toSerializable:function(e){return{ctorName:e.constructor.name,arr:bl.call(e)}},fromSerializable:function(e){return"function"==typeof Yk[e.ctorName]?new Yk[e.ctorName](e.arr):e.arr}},{type:"[[Map]]",shouldTransform:function(e,t){return $k&&t instanceof Map},toSerializable:function(e){var r=[];return e.forEach(function(e,t){r.push(t),r.push(e)}),r},fromSerializable:function(e){if($k){for(var t=new Map,r=0;r<e.length;r+=2)t.set(e[r],e[r+1]);return t}for(var n=[],i=0;i<e.length;i+=2)n.push([e[r],e[r+1]]);return n}},{type:"[[Set]]",shouldTransform:function(e,t){return _k&&t instanceof Set},toSerializable:function(e){var t=[];return e.forEach(function(e){t.push(e)}),t},fromSerializable:function(e){if(_k){for(var t=new Set,r=0;r<e.length;r++)t.add(e[r]);return t}return e}}],gl=Uk.exports=function(e){this.transforms=[],this.transformsMap=Object.create(null),this.serializer=e||cl,this.addTransforms(fl)};gl.prototype.addTransforms=function(e){e=Array.isArray(e)?e:[e];for(var t=0;t<e.length;t++){var r=e[t];if(this.transformsMap[r.type])throw new Error('Transform with type "'+r.type+'" was already added.');this.transforms.push(r),this.transformsMap[r.type]=r}return this},gl.prototype.removeTransforms=function(e){e=Array.isArray(e)?e:[e];for(var t=0;t<e.length;t++){var r=e[t],n=this.transforms.indexOf(r);-1<n&&this.transforms.splice(n,1),delete this.transformsMap[r.type]}return this},gl.prototype.encode=function(e){var t=new dl(e,this.transforms).transform();return this.serializer.serialize(t)},gl.prototype.decode=function(e){var t=this.serializer.deserialize(e);return new el(t,this.transformsMap).transform()}}(Tk={exports:{}}),Tk.exports);function eb(t,r){return new e.nativeMethods.Function("fnCode","__dependencies$","Promise",'"use strict"; return eval(fnCode)')(t,r,e.Promise)}var fb=["nodeType","textContent","childNodeCount","hasChildNodes","childElementCount","hasChildElements"],gb=["tagName","attributes"],hb=["tagName","visible","focused","attributes","boundingClientRect","classNames","style","innerText","namespaceURI","id","value","checked","selected","selectedIndex","scrollWidth","scrollHeight","scrollLeft","scrollTop","offsetWidth","offsetHeight","offsetLeft","offsetTop","clientWidth","clientHeight","clientLeft","clientTop"],ib={textContent:function(e){return e.textContent},childNodeCount:function(e){return e.childNodes.length},hasChildNodes:function(e){return!!ib.childNodeCount(e)},childElementCount:function(e){var t=e.children;if(t)return t.length;for(var r=0,n=e.childNodes.length,i=0;i<n;i++)1===e.childNodes[i].nodeType&&r++;return r},hasChildElements:function(e){return!!ib.childElementCount(e)}},jb=(Vn.prototype._initializeProperties=function(e,t,r){for(var n=0;n<t.length;n++){var i=t[n],o=r[i];this[i]=o?o(e):e[i]}},Vn);function Vn(){}var ao,kb=(l(bo,ao=jb),bo);function bo(e){var t=ao.call(this)||this;return t._initializeProperties(e,fb,ib),t}var vo,lb={tagName:function(e){return e.tagName.toLowerCase()},visible:f.positionUtils.isElementVisible,focused:function(e){return f.domUtils.getActiveElement()===e},attributes:function(e){for(var t=e.attributes,r={},n=t.length-1;0<=n;n--)r[t[n].name]=t[n].value;return r},boundingClientRect:function(e){var t=e.getBoundingClientRect();return{left:t.left,right:t.right,top:t.top,bottom:t.bottom,width:t.width,height:t.height}},classNames:function(e){var t=e.className;return(t="string"==typeof t.animVal?t.animVal:t).replace(/^\s+|\s+$/g,"").split(/\s+/g)},style:function(e){for(var t={},r=b.getComputedStyle(e),n=0;n<r.length;n++){var i=r[n];t[i]=r[i]}return t},innerText:function(e){return e.innerText}},mb=(l(wo,vo=jb),wo);function wo(e){var t=vo.call(this,e)||this;return t._initializeProperties(e,gb,lb),t}var zo,nb=(l(Ao,zo=kb),Ao);function Ao(e){var t=zo.call(this,e)||this;return t._initializeProperties(e,hb,lb),t}function pb(e){return e}var ob=b.Node;function qb(e){return new db({serialize:pb,deserialize:pb}).addTransforms(e)}var rb=(Go.prototype.shouldTransform=function(e){return"function"===e},Go.prototype.toSerializable=function(){return""},Go.prototype.fromSerializable=function(e){return eb(e.fnCode,e.dependencies)},Go);function Go(){this.type="Function"}var sb=(Lo.prototype.shouldTransform=function(e,t){return t instanceof ob},Lo.prototype.toSerializable=function(e){return new mb(e)},Lo);function Lo(){this.type="Node"}var tb=(Po.prototype._extend=function(e,r){var n=this;i.nativeMethods.objectKeys.call(b.Object,this.customDOMProperties).forEach(function(t){try{e[t]=n.customDOMProperties[t](r)}catch(e){throw new U(n.instantiationCallsiteName,e,t)}})},Po.prototype.shouldTransform=function(e,t){return t instanceof ob},Po.prototype.toSerializable=function(e){var t=new(1===e.nodeType?nb:kb)(e);return this._extend(t,e),t},Po);function Po(e){this.type="Node",this.customDOMProperties=e||{}}var ub=($o.prototype.shouldTransform=function(e,t){if(t instanceof ob)throw new L(this.instantiationCallsiteName)},$o);function $o(e){this.type="Node",this.instantiationCallsiteName=e}var vb=(cp.prototype.getResult=function(){var t=this;return e.Promise.resolve().then(function(){var e=t.replicator.decode(t.command.args);return t._executeFn(e)}).catch(function(e){throw e.isTestCafeError||(e=new T(t.command.instantiationCallsiteName,e)),e})},cp.prototype.getResultDriverStatus=function(){var t=this;return this.getResult().then(function(e){return new bb({isCommandResult:!0,result:t.replicator.encode(e)})}).catch(function(e){return new bb({isCommandResult:!0,executionError:e})})},cp.prototype._createReplicator=function(){return qb([new ub(this.command.instantiationCallsiteName),new rb])},cp.prototype._executeFn=function(e){return this.fn.apply(b,e)},cp);function cp(e){this.command=e,this.replicator=this._createReplicator(),this.dependencies=this.replicator.decode(this.command.dependencies),this.fn=eb(this.command.fnCode,this.dependencies)}var wb_appearedDialog="appeared-dialog",wb_unexpectedDialog="unexpected-dialog",wb_handlerError="handler-error",xb=i.eventSandbox.message,yb=i.processScript,zb=i.nativeMethods,Ab="testcafe|native-dialog-tracker|appeared-dialogs",Bb="testcafe|native-dialog-tracker|unexpected-dialog",Cb="testcafe|native-dialog-tracker|error-in-handler",Db=yb("window.location.href"),Eb=(Object.defineProperty(lp.prototype,"appearedDialogs",{get:function(){var e=this.contextStorage.getItem(Ab);return e||(e=[],this.appearedDialogs=e),e},set:function(e){this.contextStorage.setItem(Ab,e)},enumerable:!0,configurable:!0}),Object.defineProperty(lp.prototype,"unexpectedDialog",{get:function(){return this.contextStorage.getItem(Bb)},set:function(e){this.contextStorage.setItem(Bb,e)},enumerable:!0,configurable:!0}),Object.defineProperty(lp.prototype,"handlerError",{get:function(){return this.contextStorage.getItem(Cb)},set:function(e){this.contextStorage.setItem(Cb,e)},enumerable:!0,configurable:!0}),lp._getPageUrl=function(){return zb.eval(Db)},lp.prototype._initListening=function(){var r=this;xb.on(xb.SERVICE_MSG_RECEIVED_EVENT,function(e){var t=e.message;t.type===wb_appearedDialog?r._addAppearedDialogs(t.dialogType,t.text,t.url):t.type!==wb_unexpectedDialog||r.unexpectedDialog?t.type!==wb_handlerError||r.handlerError||r._onHandlerError(t.dialogType,t.message,t.url):r.unexpectedDialog={type:t.dialogType,url:t.url}})},lp.prototype._init=function(){var t=this;i.on(i.EVENTS.beforeUnload,function(e){e.prevented&&!e.isFakeIEEvent&&(t.dialogHandler?t._createDialogHandler("beforeunload")(e.returnValue||""):t._defaultDialogHandler("beforeunload")),t.contextStorage&&t.contextStorage.save()}),b.alert=function(){return t._defaultDialogHandler("alert")},b.confirm=function(){return t._defaultDialogHandler("confirm")},b.prompt=function(){return t._defaultDialogHandler("prompt")}},lp.prototype._createDialogHandler=function(i){var o=this;return function(e){var t=lp._getPageUrl();o._addAppearedDialogs(i,e,t);var r=new vb(o.dialogHandler),n=null;try{n=r.fn.apply(b,[i,e,t])}catch(e){o._onHandlerError(i,e.message||String(e),t)}return n}},lp.prototype._defaultDialogHandler=function(e){var t=lp._getPageUrl();this.unexpectedDialog=this.unexpectedDialog||{type:e,url:t}},lp.prototype._addAppearedDialogs=function(e,t,r){this.appearedDialogs.splice(0,0,{type:e,text:t,url:r})},lp.prototype._onHandlerError=function(e,t,r){this.handlerError=this.handlerError||{type:e,message:t,url:r}},lp.prototype.setHandler=function(e){var t=this;this.dialogHandler=e,["alert","confirm","prompt"].forEach(function(e){b[e]=t.dialogHandler?t._createDialogHandler(e):function(){return t._defaultDialogHandler(e)}})},lp.prototype.getUnexpectedDialogError=function(){var e=this.unexpectedDialog,t=this.handlerError;return this.unexpectedDialog=null,this.handlerError=null,e?new Ua(e.type,e.url):t?new Va(t.type,t.message,t.url):null},lp);function lp(e,t){this.contextStorage=e,this.dialogHandler=t,this._init(),this._initListening(),this.dialogHandler&&this.setHandler(t)}function Gb(e){this.type=e,this.id=ab()}var Up,Fb_establishConnection="driver|establish-connection",Fb_commandExecuted="driver|command-executed",Fb_executeCommand="driver|execute-command",Fb_confirmation="driver|confirmation",Fb_setNativeDialogHandler="driver|set-native-dialog-handler",Fb_setAsMaster="driver|set-as-master",Fb_closeAllChildWindows="driver|close-all-child-windows",Hb=(l(Vp,Up=Gb),Vp);function Vp(){return Up.call(this,Fb_establishConnection)||this}var Wp,Ib=(l(Xp,Wp=Gb),Xp);function Xp(e){var t=Wp.call(this,Fb_commandExecuted)||this;return t.driverStatus=e,t}var $p,Jb=(l(_p,$p=Gb),_p);function _p(e,t){var r=$p.call(this,Fb_executeCommand)||this;return r.command=e,r.testSpeed=t,r}var dq,Kb=(l(eq,dq=Gb),eq);function eq(e,t){var r=dq.call(this,Fb_confirmation)||this;return r.requestMessageId=e,r.result=t,r}var iq,Lb=(l(jq,iq=Gb),jq);function jq(e){var t=iq.call(this,Fb_setNativeDialogHandler)||this;return t.dialogHandler=e,t}var mq,Mb=(l(nq,mq=Gb),nq);function nq(){return mq.call(this,Fb_setAsMaster)||this}var oq,Nb=(l(pq,oq=Gb),pq);function pq(){return oq.call(this,Fb_closeAllChildWindows)||this}var Ob=i.json,Pb=i.nativeMethods,Rb=(qq.prototype._createStorageKey=function(e,t){var r="testcafe|driver|"+e;return t?r+"|"+t:r},qq.prototype._loadFromStorage=function(){var e=this.storage.getItem(this.storageKey);e&&(this.data=Ob.parse(e),this.storage.removeItem(this.storageKey))},qq.prototype.save=function(){this.storage.setItem(this.storageKey,Ob.stringify(this.data))},qq.prototype.setItem=function(e,t){this.data[e]=t,this.save()},qq.prototype.getItem=function(e){return this.data[e]},qq.prototype.dispose=function(){this.storage.removeItem(this.storageKey)},qq);function qq(e,t,r){this.storage=Pb.winSessionStorageGetter.call(e),this.storageKey=this._createStorageKey(t,r),this.data={},this._loadFromStorage()}function Ub(r,n,t,i){var o=null,a=null;return t=Math.max(t||0,2500),e.Promise.race([f.delay(t),new e.Promise(function(t){a=function(e){e.message.type===Fb_confirmation&&e.message.requestMessageId===r.id&&t(e.message)},e.eventSandbox.message.on(e.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,a),o=e.nativeMethods.setInterval.call(b,function(){return e.eventSandbox.message.sendServiceMsg(r,n)},1e3),e.eventSandbox.message.sendServiceMsg(r,n)})]).then(function(t){if(e.nativeMethods.clearInterval.call(b,o),e.nativeMethods.clearTimeout.call(b,null),e.eventSandbox.message.off(e.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,a),!t)throw new i;return t})}function $b(t){var r=t.requestMsgId,n=t.result,i=t.window,o=new Kb(r,n);e.eventSandbox.message.sendServiceMsg(o,i)}var _b=(Object.defineProperty(Rq.prototype,"availabilityTimeout",{set:function(e){this.iframeAvailabilityTimeout=e},enumerable:!0,configurable:!0}),Rq.prototype._ensureIframe=function(){var t=this;return f.domUtils.isElementInDocument(this.driverIframe)?f.waitFor(function(){return f.positionUtils.isElementVisible(t.driverIframe)?t.driverIframe:null},200,this.iframeAvailabilityTimeout).catch(function(){throw new Ta}):e.Promise.reject(new Sa)},Rq.prototype._waitForIframeRemovedOrHidden=function(){var r=this;return new e.Promise(function(t){r.checkIframeInterval=e.nativeMethods.setInterval.call(b,function(){r._ensureIframe().catch(function(){return f.delay(500).then(function(){return t(new bb({isCommandResult:!0}))})})},1e3)})},Rq.prototype._waitForCommandResult=function(){var r=this,n=null;return e.Promise.race([this._waitForIframeRemovedOrHidden(),new e.Promise(function(t){n=function(e){e.message.type===Fb_commandExecuted&&t(e.message.driverStatus)},e.eventSandbox.message.on(e.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,n)})]).then(function(t){return e.eventSandbox.message.off(e.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,n),e.nativeMethods.clearInterval.call(b,r.checkIframeInterval),t})},Rq.prototype.sendConfirmationMessage=function(e){$b({requestMsgId:e,result:{id:this.driverId},window:this.driverWindow})},Rq.prototype.executeCommand=function(r,n){var i=this;return this._ensureIframe().then(function(){var t=new Jb(r,n);return e.Promise.all([Ub(t,i.driverWindow,i.iframeAvailabilityTimeout,Na),i._waitForCommandResult()])}).then(function(e){return e[1]})},Rq);function Rq(e,t){this.driverWindow=e,this.driverIframe=f.domUtils.findIframeByWindow(e),this.driverId=t,this.iframeAvailabilityTimeout=0}var ac=i.Promise,bc=i.nativeMethods,dc=(ir.prototype._onScriptElementAdded=function(e){var t=this,r=bc.scriptSrcGetter.call(e);if(void 0!==r&&""!==r){this.scriptsCount++;var n=null,i=function(){bc.removeEventListener.call(e,"load",i),bc.removeEventListener.call(e,"error",i),bc.clearTimeout.call(b,n),t._onScriptLoadedOrFailed()};bc.addEventListener.call(e,"load",i),bc.addEventListener.call(e,"error",i),n=bc.setTimeout.call(b,i,this.SCRIPT_LOADING_TIMEOUT)}},ir.prototype._onScriptLoadedOrFailed=function(){var e=this;this.scriptsCount--,this.scriptsCount||f.delay(25).then(function(){e.resolveWaitingPromise&&(e.scriptsCount||e.resolveWaitingPromise())})},ir.prototype.wait=function(){var r=this;return new ac(function(e){function t(){bc.clearTimeout.call(b,r.watchdog),i.off(i.EVENTS.scriptElementAdded,r.scriptElementAddedHandler),r.watchdog=null,r.resolveWaitingPromise=null,e()}r.scriptsCount?(r.watchdog=bc.setTimeout.call(b,function(){return t()},r.BARRIER_TIMEOUT),r.resolveWaitingPromise=function(){return t()}):t()})},ir);function ir(){var t=this;this.watchdog=null,this.SCRIPT_LOADING_TIMEOUT=2e3,this.BARRIER_TIMEOUT=3e3,this.scriptsCount=0,this.resolveWaitingPromise=null,this.scriptElementAddedHandler=function(e){return t._onScriptElementAdded(e.el)},i.on(i.EVENTS.scriptElementAdded,this.scriptElementAddedHandler)}function ec(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var i=new f.RequestBarrier,o=new dc;f.pageUnloadBarrier.watchForPageNavigationTriggers();var a=null,s=t.apply(void 0,r),l=s.then(function(t){return a=t,e.Promise.all([i.wait().then(function(){return o.wait()}),f.pageUnloadBarrier.wait()])}).then(function(){return a});return{actionPromise:s,barriersPromise:l}}var nc,fc=Array.isArray,gc=b.Node,hc=b.HTMLCollection,ic=b.NodeList;function jc(e){return!!e}function kc(e){return!(!f.domUtils.isDomElement(e)&&!f.domUtils.isTextNode(e))&&(f.domUtils.isOptionElement(e)||"optgroup"===f.domUtils.getTagName(e)?h.selectElement.isOptionElementVisible(e):f.positionUtils.isElementVisible(e))}function lc(e){return e instanceof hc||e instanceof ic||function(e){if(fc(e)){for(var t=0;t<e.length;t++)if(!(e[t]instanceof gc))return;return 1}}(e)}var oc=j.arrayUtils,pc=i.utils.types,qc=i.nativeMethods,rc_filterVisible=1,rc_filterHidden=2,rc_nth=3,sc=((nc={})[rc_filterVisible]=/^\.filterVisible\(\)$/,nc[rc_filterHidden]=/^\.filterHidden\(\)$/,nc[rc_nth]=/^\.nth\(\d+\)$/,nc),tc=(Object.defineProperty(Ir.prototype,"error",{get:function(){return this.err},set:function(e){null===this.err&&(this.err=e)},enumerable:!0,configurable:!0}),Ir.prototype.filter=function(e,t,r){var n=oc.filter(e,jc);if(t.filterVisible&&(n=n.filter(kc),this.assertFilterError(n,r,rc_filterVisible)),t.filterHidden&&(n=n.filter(function(e){return!kc(e)}),this.assertFilterError(n,r,rc_filterHidden)),t.counterMode)n=null!==t.index?this.getNodeByIndex(n,t.index)?1:0:n.length;else{if(t.getVisibleValueMode){var i=e[0];return!!i&&kc(i)}if(t.collectionMode){if(null!==t.index){var o=this.getNodeByIndex(n,t.index);n=o?[o]:[]}}else n=this.getNodeByIndex(n,t.index||0);"number"==typeof t.index&&this.assertFilterError(n,r,rc_nth)}return n},Ir.prototype.cast=function(e){var t=null;if(pc.isNullOrUndefined(e))t=[];else if(e instanceof Node)t=[e];else{if(!lc(e))throw new N;t=e}return t},Ir.prototype.assertFilterError=function(e,t,r){e&&0!==e.length||(this.error=this.getErrorItem(t,r))},Ir.prototype.getErrorItem=function(e,t){var r=e.apiFnChain,n=e.apiFnID;if(t)for(var i=n;i<r.length;i++)if(sc[t].test(r[i]))return i;return null},Ir.prototype.getNodeByIndex=function(e,t){return t<0?e[e.length+t]:e[t]},Ir);function Ir(){this.err=null}qc.objectDefineProperty.call(b,b,"%testCafeSelectorFilter%",{value:new tc,configurable:!0});var cs,wc=(l(ds,cs=vb),ds.prototype._createReplicator=function(){return qb([new rb])},ds.prototype._getTimeoutErrorParams=function(){var e=b["%testCafeSelectorFilter%"].error,t=this.command.apiFnChain;return void 0!==e?{apiFnIndex:e,apiFnChain:t}:null},ds.prototype._validateElement=function(o,a){var s=this;return e.Promise.resolve().then(function(){return s.fn.apply(b,o)}).then(function(e){var t=jc(e),r=!s.command.visibilityCheck||kc(e),n=t?s.createIsInvisibleError:s.createNotFoundError,i=new Date-a>=s.timeout;if(t&&r)return e;if(!i)return f.delay(200).then(function(){return s._validateElement(o,a)});if(n)throw n(s._getTimeoutErrorParams());return null})},ds.prototype._executeFn=function(e){if(this.returnSinglePropMode)return cs.prototype._executeFn.call(this,e);var t=new Date,r=null,n=null;return this._validateElement(e,t).catch(function(e){r=e}).then(function(e){if(r)throw r;n=e}).then(function(){return n})},ds);function ds(e,t,r,n,i){var o,a=cs.call(this,e)||this;if(a.createNotFoundError=n,a.createIsInvisibleError=i,a.timeout="number"==typeof e.timeout?e.timeout:t,a.returnSinglePropMode=!!(o=a.dependencies.filterOptions)&&(o.counterMode||o.getVisibleValueMode),r){var s=new Date-r;a.timeout=Math.max(a.timeout-s,0)}var l=a.dependencies&&a.dependencies.customDOMProperties;return a.replicator.addTransforms([new tb(l)]),a}var xc=(Cs.prototype._ensureElement=function(e){var t=this,r=e.selector,n=e.createNotFoundError,i=e.createIsInvisibleError,o=e.createHasWrongNodeTypeError;this.ensureElementsPromise=this.ensureElementsPromise.then(function(){return new wc(r,t.globalSelectorTimeout,t.ensureElementsStartTime,n,i).getResult()}).then(function(e){if(!f.domUtils.isDomElement(e))throw o(f.NODE_TYPE_DESCRIPTIONS[e.nodeType]);t.elements.push(e)})},Cs.prototype.getElements=function(){var e=this;return this.ensureElementsPromise.then(function(){return e.elements})},Cs);function Cs(t,r){var n=this;this.elements=[],this.globalSelectorTimeout=r,this.ensureElementsPromise=e.Promise.resolve(),this.ensureElementsStartTime=new Date,t.forEach(function(e){return n._ensureElement(e)})}function yc(e,t){return new xc(e,t).getElements()}function zc(e){return{selector:e,createNotFoundError:function(e){return new ra(e)},createIsInvisibleError:function(){return new sa},createHasWrongNodeTypeError:function(e){return new ta(e)}}}function Ac(e,t){return{selector:e,createNotFoundError:function(e){return new ua(t,e)},createIsInvisibleError:function(){return new va(t)},createHasWrongNodeTypeError:function(e){return new wa(t,e)}}}function Dc(e,t){if(!f.domUtils.isContentEditableElement(e))throw new za(t)}var Jc=(jt.prototype._getSpecificTimeout=function(){return this.command.selector&&"number"==typeof this.command.selector.timeout?this.command.selector.timeout:this.globalSelectorTimeout},jt.prototype._delayAfterExecution=function(){return this.command.options&&1!==this.command.options.speed?f.delay(2e3*(1-this.command.options.speed)):e.Promise.resolve()},jt.prototype._isExecutionTimeoutExpired=function(){return Date.now()-this.executionStartTime>=this.commandSelectorTimeout},jt.prototype._ensureCommandArguments=function(){if(this.command.type===v.pressKey&&f.parseKeySequence(this.command.keys).error)throw new Ba("keys")},jt.prototype._ensureCommandElements=function(){var t=this,e=[];return this.command.selector&&e.push(zc(this.command.selector)),this.command.type===v.dragToElement?e.push(Ac(this.command.destinationSelector,"destinationSelector")):this.command.type===v.selectEditableContent&&(e.push(Ac(this.command.startSelector,"startSelector")),e.push(Ac(this.command.endSelector||this.command.startSelector,"endSelector"))),yc(e,this.globalSelectorTimeout).then(function(e){t.elements=e})},jt.prototype._ensureCommandElementsProperties=function(){this.command.type===v.selectText?function(e){if(!f.domUtils.isEditableElement(e))throw new xa}(this.elements[0]):this.command.type===v.selectTextAreaContent?function(e){if(!f.domUtils.isTextAreaElement(e))throw new ya}(this.elements[0]):this.command.type===v.selectEditableContent?(Dc(this.elements[0],"startSelector"),Dc(this.elements[1],"endSelector"),function(e){if(!f.contentEditable.getNearestCommonAncestor(e[0],e[1]))throw new Aa}(this.elements)):this.command.type!==v.setFilesToUpload&&this.command.type!==v.clearUpload||function(e){if(!f.domUtils.isFileInput(e))throw new Da}(this.elements[0])},jt.prototype._ensureCommandOptions=function(){var e,t,r,n,i;this.elements.length&&this.command.options&&"offsetX"in this.command.options&&"offsetY"in this.command.options&&(e=this.elements[0],t=this.command.options,r=g.getOffsetOptions(e,t.offsetX,t.offsetY),n=r.offsetX,i=r.offsetY,t.offsetX=n,t.offsetY=i)},jt.prototype._createAutomation=function(){var e=null;switch(this.command.type){case v.click:return/option|optgroup/.test(f.domUtils.getTagName(this.elements[0]))?new g.SelectChildClick(this.elements[0],this.command.options):new g.Click(this.elements[0],this.command.options);case v.rightClick:return new g.RClick(this.elements[0],this.command.options);case v.doubleClick:return new g.DblClick(this.elements[0],this.command.options);case v.hover:return new g.Hover(this.elements[0],this.command.options);case v.drag:return new g.DragToOffset(this.elements[0],this.command.dragOffsetX,this.command.dragOffsetY,this.command.options);case v.dragToElement:return new g.DragToElement(this.elements[0],this.elements[1],this.command.options);case v.typeText:return new g.Type(this.elements[0],this.command.text,this.command.options);case v.selectText:case v.selectTextAreaContent:return e=g.calculateSelectTextArguments(this.elements[0],this.command),new g.SelectText(this.elements[0],e.startPos,e.endPos,this.command.options);case v.selectEditableContent:return new g.SelectEditableContent(this.elements[0],this.elements[1],this.command.options);case v.pressKey:return new g.Press(f.parseKeySequence(this.command.keys).combinations,this.command.options);case v.setFilesToUpload:return new g.Upload(this.elements[0],this.command.filePath,function(e){return new Ca(e)});case v.clearUpload:return new g.Upload(this.elements[0])}return null},jt.prototype._runAction=function(t){var r=this;return this._ensureCommandElements().then(function(){return r._ensureCommandElementsProperties()}).then(function(){r._ensureCommandOptions();var e=r._createAutomation();return e.TARGET_ELEMENT_FOUND_EVENT?e.on(e.TARGET_ELEMENT_FOUND_EVENT,function(e){r.targetElement=e.element,r.statusBar.hideWaitingElementStatus(!0),r.executionStartedHandler()}):(r.statusBar.hideWaitingElementStatus(!0),r.executionStartedHandler()),e.run(t)})},jt.prototype._runRecursively=function(){var r=this,t=!1,n=!0;return f.promiseUtils.whilst(function(){return!t},function(){return r._runAction(n).then(function(){t=!0}).catch(function(t){if(r._isExecutionTimeoutExpired()){if(t.message===g.ERROR_TYPES.foundElementIsNotTarget)return n=!1,e.Promise.resolve();throw t.message===g.ERROR_TYPES.elementIsInvisibleError?new sa:t}return f.delay(250)})})},jt.prototype.execute=function(){var o=this;return this.command.options&&!this.command.options.speed&&(this.command.options.speed=this.testSpeed),{startPromise:new e.Promise(function(e){o.executionStartedHandler=e}),completionPromise:new e.Promise(function(r){o.executionStartTime=new Date;try{o._ensureCommandArguments()}catch(e){return void r(new bb({isCommandResult:!0,executionError:e}))}o.commandSelectorTimeout=o._getSpecificTimeout(),o.statusBar.showWaitingElementStatus(o.commandSelectorTimeout);var t=ec(function(){return o._runRecursively()}),n=t.actionPromise,i=t.barriersPromise;n.then(function(){return e.Promise.all([o._delayAfterExecution(),i])}).then(function(){var e={isCommandResult:!0},t=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n}(o.elements);o.targetElement&&(t[0]=o.targetElement),e.result=qb(new sb).encode(t),r(new bb(e))}).catch(function(e){return o.statusBar.hideWaitingElementStatus(!1).then(function(){return r(new bb({isCommandResult:!0,executionError:e}))})})})}},jt);function jt(e,t,r,n){this.command=e,this.globalSelectorTimeout=t,this.statusBar=r,this.testSpeed=n,this.targetElement=null,this.elements=[],this.ensureElementsPromise=null,this.ensureElementsStartTime=null,this.executionStartTime=null,this.executionStartedHandler=null,this.commandSelectorTimeout=null}function Lc(e,t,r){return Math.min(Math.max(t,e),r)}function Mc(e,t){var r="number"==typeof e.min,n="number"==typeof e.max,i="number"==typeof e.length;return i&&(e.length=Lc(e.length,0,t)),r&&e.min<0&&(e.min+=t),n&&e.max<0&&(e.max+=t),r||(e.min=n&&i?e.max-e.length:0),n||(e.max=i?e.min+e.length:t),e.min=Lc(e.min,0,t),e.max=Lc(e.max,0,t),e.length=e.max-e.min,e}function Nc(e,t,r){return Math.round(e+Lc(t-e,0,r)/2)}function Pc(n){return function(e,t){var r=typeof t;if("number"!=r)throw new n(e,r);if(isNaN(t)||!isFinite(t)||t!==Math.floor(t))throw new n(e,t)}}var Bu,Cu,Fu,Ju,Nu,Tc=Pc(ba),Uc=(Cu=Pc(Bu=ca),function(e,t){if(Cu(e,t),t<0)throw new Bu(e,t)}),Vc=(Fu=da,function(e,t){var r=typeof t;if("boolean"!=r)throw new Fu(e,r)}),Wc=(Ju=fa,function(e,t){var r=typeof t;if("number"!=r)throw new Ju(e,r);if(isNaN(t)||t<.01||1<t)throw new Ju(e,t)}),Xc=(l(Ou,Nu=_a),Ou.prototype._getAssignableProperties=function(){return[{name:"speed",type:Wc}]},Ou);function Ou(e,t){var r=Nu.call(this)||this;return r.speed=null,r._assignFrom(e,t),r}var Su,Yc=(l(Tu,Su=Xc),Tu.prototype._getAssignableProperties=function(){return Su.prototype._getAssignableProperties.call(this).concat([{name:"offsetX",type:Tc},{name:"offsetY",type:Tc}])},Tu);function Tu(e,t){var r=Su.call(this)||this;return r.offsetX=null,r.offsetY=null,r._assignFrom(e,t),r}var Xu,Zc=(l(Yu,Xu=Yc),Yu.prototype._getAssignableProperties=function(){return Xu.prototype._getAssignableProperties.call(this).concat([{name:"scrollToCenter",type:Vc},{name:"skipParentFrames",type:Vc}])},Yu);function Yu(e,t){var r=Xu.call(this)||this;return r.scrollToCenter=!1,r.skipParentFrames=!1,r._assignFrom(e,t),r}var av,$c=(l(bv,av=Xc),bv.prototype._getAssignableProperties=function(){return av.prototype._getAssignableProperties.call(this).concat([{name:"scrollTargetX",type:Tc},{name:"scrollTargetY",type:Tc},{name:"crop.left",type:Tc},{name:"crop.right",type:Tc},{name:"crop.top",type:Tc},{name:"crop.bottom",type:Tc},{name:"includeMargins",type:Vc},{name:"includeBorders",type:Vc},{name:"includePaddings",type:Vc}])},bv);function bv(e,t){var r=av.call(this)||this;return r.scrollTargetX=null,r.scrollTargetY=null,r.includeMargins=!1,r.includeBorders=!0,r.includePaddings=!0,r.crop={left:null,right:null,top:null,bottom:null},r._assignFrom(e,t),r}var fv,_c=(l(gv,fv=Yc),gv.prototype._getAssignableProperties=function(){return fv.prototype._getAssignableProperties.call(this).concat([{name:"modifiers.ctrl",type:Vc},{name:"modifiers.alt",type:Vc},{name:"modifiers.shift",type:Vc},{name:"modifiers.meta",type:Vc}])},gv);function gv(e,t){var r=fv.call(this)||this;return r.modifiers={ctrl:!1,alt:!1,shift:!1,meta:!1},r._assignFrom(e,t),r}var kv,pv,uv,zv,Ev,Jv,ad=(l(lv,kv=_c),lv.prototype._getAssignableProperties=function(){return kv.prototype._getAssignableProperties.call(this).concat([{name:"caretPos",type:Uc}])},lv);function lv(e,t){var r=kv.call(this)||this;return r.caretPos=null,r._assignFrom(e,t),r}function qv(e,t){var r=pv.call(this)||this;return r.speed=null,r.minMovingTime=null,r.holdLeftButton=!1,r.skipScrolling=!1,r.skipDefaultDragBehavior=!1,r._assignFrom(e,t),r}function vv(e,t){var r=uv.call(this)||this;return r.replace=!1,r.paste=!1,r._assignFrom(e,t),r}function Av(e,t){var r=zv.call(this,e,t)||this;return r.destinationOffsetX=null,r.destinationOffsetY=null,r._assignFrom(e,t),r}function Fv(e,t){var r=Ev.call(this)||this;return r.portraitOrientation=!1,r._assignFrom(e,t),r}function Kv(e,t){var r=Jv.call(this)||this;return r.timeout=void 0,r.allowUnawaitedPromise=!1,r._assignFrom(e,t),r}l(qv,pv=_c),qv.prototype._getAssignableProperties=function(){return pv.prototype._getAssignableProperties.call(this).concat([{name:"speed"},{name:"minMovingTime"},{name:"holdLeftButton"},{name:"skipScrolling",type:Vc},{name:"skipDefaultDragBehavior",type:Vc}])},l(vv,uv=ad),vv.prototype._getAssignableProperties=function(){return uv.prototype._getAssignableProperties.call(this).concat([{name:"replace",type:Vc},{name:"paste",type:Vc}])},l(Av,zv=_c),Av.prototype._getAssignableProperties=function(){return zv.prototype._getAssignableProperties.call(this).concat([{name:"destinationOffsetX",type:Tc},{name:"destinationOffsetY",type:Tc}])},l(Fv,Ev=_a),Fv.prototype._getAssignableProperties=function(){return[{name:"portraitOrientation",type:Vc}]},l(Kv,Jv=_a),Kv.prototype._getAssignableProperties=function(){return[{name:"timeout",type:Uc},{name:"allowUnawaitedPromise",type:Vc}]};var gd=e.eventSandbox.message,jd="driver|browser-manipulation|request",kd="driver|browser-manipulation|response";gd.on(gd.SERVICE_MSG_RECEIVED_EVENT,function(t){if(t.message.cmd===jd){var e=f.domUtils.findIframeByWindow(t.source),r=t.message,n=r.command,i=r.cropDimensions;i&&(n.options=new $c({crop:i,includePaddings:!1}));var o=new ld(n);o.element=e,o.execute().then(function(e){return gd.sendServiceMsg({cmd:kd,result:e},t.source)})}});var ld=(Vv.prototype._getAbsoluteCropValues=function(){var e=this.element.getBoundingClientRect(),t=e.top,r=e.left;r+=this.command.options.originOffset.x,t+=this.command.options.originOffset.y;var n=r+this.command.options.crop.right,i=t+this.command.options.crop.bottom;return{top:t+=this.command.options.crop.top,left:r+=this.command.options.crop.left,bottom:i,right:n}},Vv.prototype._createManipulationReadyMessage=function(){var e=b.devicePixelRatio||1,t={cmd:u_readyForBrowserManipulation,pageDimensions:{dpr:e,innerWidth:b.innerWidth,innerHeight:b.innerHeight,documentWidth:d.documentElement.clientWidth,documentHeight:d.documentElement.clientHeight,bodyWidth:d.body.clientWidth,bodyHeight:d.body.clientHeight},disableResending:!0};return this.command.type===v.takeElementScreenshot&&(t.cropDimensions=this._getAbsoluteCropValues()),t},Vv.prototype._runScrollBeforeScreenshot=function(){var i=this;return e.Promise.resolve().then(function(){if(i.element||!i.command.selector)return e.Promise.resolve();var t=i.command.selector.timeout,r="number"==typeof t?t:i.globalSelectorTimeout;return i.statusBar.showWaitingElementStatus(r),yc([zc(i.command.selector)],i.globalSelectorTimeout).then(function(e){i.statusBar.hideWaitingElementStatus(),i.element=e[0]}).catch(function(e){throw i.statusBar.hideWaitingElementStatus(),e})}).then(function(){!function(e,t){var r=e.getBoundingClientRect(),n={left:r.left,right:r.right,top:r.top,bottom:r.bottom},i=f.styleUtils.getElementMargin(e),o=f.styleUtils.getElementPadding(e),a=f.styleUtils.getBordersWidth(e);t.originOffset={x:0,y:0};var s=n.left+e.scrollWidth+a.left+a.right,l=n.top+e.scrollHeight+a.top+a.bottom;n.right=Math.max(n.right,s),n.bottom=Math.max(n.bottom,l),t.includeBorders&&t.includePaddings?t.includeMargins&&(t.originOffset.x-=i.left,t.originOffset.y-=i.top,n.left-=i.left,n.top-=i.top,n.right+=i.right,n.bottom+=i.bottom):(t.originOffset.x+=a.left,t.originOffset.y+=a.top,n.left+=a.left,n.top+=a.top,n.right-=a.right,n.bottom-=a.bottom,t.includePaddings||(t.originOffset.x+=o.left,t.originOffset.y+=o.top,n.left+=o.left,n.top+=o.top,n.right-=o.right,n.bottom-=o.bottom)),n.width=n.right-n.left,n.height=n.bottom-n.top;var c=Mc({min:t.crop.left,max:t.crop.right,length:t.crop.width},n.width),u=Mc({min:t.crop.top,max:t.crop.bottom,length:t.crop.height},n.height);if(t.crop.left=c.min,t.crop.right=c.max,t.crop.width=c.length,t.crop.top=u.min,t.crop.bottom=u.max,t.crop.height=u.length,t.crop.width<=0||t.crop.height<=0)throw new Ia(t.crop.width,t.crop.height);var d=f.styleUtils.getViewportDimensions();(n.width>d.width||n.height>d.height)&&(t.scrollToCenter=!0);var h="number"==typeof t.scrollTargetX,m="number"==typeof t.scrollTargetY;h||(t.scrollTargetX=Nc(t.crop.left,t.crop.right,d.width)),m||(t.scrollTargetY=Nc(t.crop.top,t.crop.bottom,d.height));var p=g.getOffsetOptions(e,t.scrollTargetX,t.scrollTargetY),v=p.offsetX,_=p.offsetY;t.scrollTargetX=v,t.scrollTargetY=_;var E=!h||t.scrollTargetX>=t.crop.left&&t.scrollTargetX<=t.crop.right,y=!m||t.scrollTargetY>=t.crop.top&&t.scrollTargetY<=t.crop.bottom;if(!E||!y)throw new Ea(E,y)}(i.element,i.command.options);var e=i.command.options,t=e.scrollTargetX,r=e.scrollTargetY,n=e.scrollToCenter;return new g.Scroll(i.element,new Zc({offsetX:t,offsetY:r,scrollToCenter:n,skipParentFrames:!0})).run()})},Vv.prototype._hideUI=function(){return h.hide(),this.command.markData&&h.showScreenshotMark(this.command.markData),f.delay(500)},Vv.prototype._showUI=function(){this.command.markData&&h.hideScreenshotMark(),h.show()},Vv.prototype._requestManipulation=function(){if(b.top===b)return e.transport.queuedAsyncServiceMsg(this._createManipulationReadyMessage());var t=this._getAbsoluteCropValues();return f.sendRequestToFrame({cmd:jd,command:this.command,cropDimensions:t},kd,b.parent).then(function(e){if(!e.result)return{result:null};var t=e.result,r=t.result,n=t.executionError;if(n)throw n;return{result:r}})},Vv.prototype._runManipulation=function(){var n=this,i=null;return e.Promise.resolve().then(function(){return n.command.type!==v.takeElementScreenshot?e.Promise.resolve():(f.scrollController.stopPropagation(),n._runScrollBeforeScreenshot())}).then(function(){return b.top===b?n._hideUI():e.Promise.resolve()}).then(function(){return n._requestManipulation()}).then(function(e){var t=e.result,r=e.error;if(r)throw r;return f.scrollController.enablePropagation(),i=t,b.top===b&&n._showUI(),f.delay(200)}).then(function(){return new bb({isCommandResult:!0,result:i})}).catch(function(e){return f.scrollController.enablePropagation(),new bb({isCommandResult:!0,executionError:e})})},Vv.prototype.execute=function(){var e=this;return ec(function(){return e._runManipulation()}).barriersPromise},Vv);function Vv(e,t,r){this.command=e,this.globalSelectorTimeout=t,this.statusBar=r,this.element=null}var nd=i.createNativeXHR,od=i.utils,sd=i.Promise,ud=(fx.prototype.setAsMaster=function(){return Ub(new Mb,this.driverWindow,5e3,Qa)},fx.prototype.closeAllChildWindows=function(){return Ub(new Nb,this.driverWindow,5e3,Ra)},fx);function fx(e,t){this.driverWindow=e,this.windowId=t}var vd=(kx.prototype._getTopOpenedWindow=function(e){for(var t=e;t.opener;)t=t.opener;return t},kx.prototype._setAsMaster=function(e){return Ub(new Mb,e,5e3,Qa)},kx.prototype.setTopOpenedWindowAsMaster=function(){var e=this._getTopOpenedWindow(this.currentDriverWindow);return this._setAsMaster(e)},kx.prototype.setParentWindowAsMaster=function(){var e=this.currentDriverWindow.opener;return this._setAsMaster(e)},kx);function kx(e){this.currentDriverWindow=e}var sx,wd_master="master",wd_replica="replica",xd=i.transport,yd=i.Promise,zd=i.eventSandbox.message,Ad=i.storages,Bd=i.nativeMethods,Cd=Bd.date,Dd="testcafe|driver|test-done-sent-flag",Ed="testcafe|driver|pending-status",Fd="testcafe|driver|executing-client-function-descriptor",Gd="testcafe|driver|selector-execution-start-time",Hd="testcafe|driver|pending-page-error",Id="testcafe|driver|active-iframe-selector",Jd="testcafe|driver|test-speed",Kd="testcafe|driver|assertion-retries-timeout",Ld="testcafe|driver|assertion-retries-start-time",Md="testcafe|driver|console-messages",Nd={NotLoadedError:Ma,NotFoundError:ra,IsInvisibleError:sa},Od={NotLoadedError:Na,NotFoundError:Sa,IsInvisibleError:Ta},Pd=Math.pow(2,31)-1,Rd="status-with-command-result-event",Sd="empty-command-event",Td=(l(tx,sx=f.serviceUtils.EventEmitter),Object.defineProperty(tx.prototype,"speed",{get:function(){return this.contextStorage.getItem(Jd)},set:function(e){this.contextStorage.setItem(Jd,e)},enumerable:!0,configurable:!0}),Object.defineProperty(tx.prototype,"consoleMessages",{get:function(){return new $a(this.contextStorage.getItem(Md))},set:function(e){return this.contextStorage.setItem(Md,e?e.getCopy():null)},enumerable:!0,configurable:!0}),tx.prototype._hasPendingActionFlags=function(e){return e.getItem(this.COMMAND_EXECUTING_FLAG)||e.getItem(this.EXECUTING_IN_IFRAME_FLAG)},tx.prototype._getCurrentWindowId=function(){var e=b.location.toString(),t=i.utils.url.parseProxyUrl(e);return t&&t.windowId||null},tx.prototype._onJsError=function(e){if(this.skipJsErrors||this.contextStorage.getItem(Dd))return yd.resolve();var t=new Q(e.stack,e.pageUrl);return this.contextStorage.getItem(Hd)||this.contextStorage.setItem(Hd,t),null},tx.prototype._unlockPageAfterTestIsDone=function(){return f.disableRealEventsPreventing(),yd.resolve()},tx.prototype._failIfClientCodeExecutionIsInterrupted=function(){var e=this.contextStorage.getItem(Fd);return!!e&&(this._onReady(new bb({isCommandResult:!0,executionError:new K(e.instantiationCallsiteName)})),!0)},tx.prototype.onCustomClientScriptError=function(e,t){var r=t?new Y(e,t):new X(e);this.contextStorage.getItem(Hd)||this.contextStorage.setItem(Hd,r)},tx.prototype._addChildWindowDriverLink=function(e){var t=new ud(e.window,e.windowId);this.childWindowDriverLinks.push(t),this._ensureClosedChildWindowWatcher()},tx.prototype._ensureClosedChildWindowWatcher=function(){var t=this;this.checkClosedChildWindowIntervalId||(this.checkClosedChildWindowIntervalId=Bd.setInterval.call(b,function(){var e=f.arrayUtils.find(t.childWindowDriverLinks,function(e){return e.driverWindow.closed});e&&(f.arrayUtils.remove(t.childWindowDriverLinks,e),t._setCurrentWindowAsMaster(),t.childWindowDriverLinks.length||Bd.clearInterval.call(b,t.checkClosedChildWindowIntervalId))},200))},tx.prototype._setAsMasterInProgressOrCompleted=function(){return this.setAsMasterInProgress||this.role===wd_master},tx.prototype._setCurrentWindowAsMaster=function(){var e=this;this._setAsMasterInProgressOrCompleted()||(this.setAsMasterInProgress=!0,yd.resolve().then(function(){return f.browser.setActiveWindowId(e.browserActiveWindowId,i.createNativeXHR,e.windowId)}).then(function(){e._startInternal({finalizePendingCommand:!0,isFirstRequestAfterWindowSwitching:!0}),e.setAsMasterInProgress=!1}).catch(function(){e._onReady(new bb({isCommandResult:!0,executionError:new Qa}))}))},tx.prototype._onChildWindowOpened=function(e){this._addChildWindowDriverLink(e),this._switchToChildWindow(e.windowId)},tx.prototype._onFormSubmit=function(e){this.contextStorage&&this.contextStorage.getItem(Dd)&&(e.preventSubmit=!0)},tx.prototype._onConsoleMessage=function(e){var t=e.meth,r=e.line,n=this.consoleMessages;n.addMessage(t,r,this.windowId),this.consoleMessages=n},tx.prototype._addPendingErrorToStatus=function(e){var t=this.contextStorage.getItem(Hd);t&&(this.contextStorage.setItem(Hd,null),e.pageError=t)},tx.prototype._addUnexpectedDialogErrorToStatus=function(e){var t=this.nativeDialogsTracker.getUnexpectedDialogError();e.pageError=e.pageError||t},tx.prototype._addConsoleMessagesToStatus=function(e){e.consoleMessages=this.consoleMessages,this.consoleMessages=null},tx.prototype._addPendingWindowSwitchingStateToStatus=function(e){e.isPendingWindowSwitching=!!this.contextStorage.getItem(this.PENDING_WINDOW_SWITCHING_FLAG)},tx.prototype._sendStatusRequest=function(e){function t(){return f.getTimeLimitedPromise(xd.asyncServiceMsg(n),5e3)}function r(){return f.delay(300).then(t)}for(var n={cmd:u_ready,status:e,disableResending:!0,allowRejecting:!0},i=t(),o=0;o<s;o++)i=i.catch(r);return i},tx.prototype._sendStatus=function(e){var t=this;e.resent||(this._addPendingErrorToStatus(e),this._addUnexpectedDialogErrorToStatus(e),this._addConsoleMessagesToStatus(e),this._addPendingWindowSwitchingStateToStatus(e)),this.contextStorage.setItem(Ed,e);var r=null;return f.pageUnloadBarrier.wait(0).then(function(){return t._sendStatusRequest(e)}).then(function(e){return r=e,f.pageUnloadBarrier.wait(0)}).then(function(){return t.contextStorage.setItem(Ed,null),r})},tx.prototype._addChildIframeDriverLink=function(e,t){var r=this._getChildIframeDriverLinkByWindow(t);if(!r){var n=this.testRunId+"-"+ab();r=new _b(t,n),this.childIframeDriverLinks.push(r)}r.sendConfirmationMessage(e)},tx.prototype._handleSetAsMasterMessage=function(e,t){var r=this;this._setAsMasterInProgressOrCompleted()||(this.setAsMasterInProgress=!0,$b({requestMsgId:e.id,window:t}),yd.resolve().then(function(){return f.browser.setActiveWindowId(r.browserActiveWindowId,i.createNativeXHR,r.windowId)}).then(function(){r._startInternal(),r.setAsMasterInProgress=!1}).catch(function(){r._onReady(new bb({isCommandResult:!0,executionError:new Qa}))}))},tx.prototype._handleCloseAllWindowsMessage=function(e,t){var r=this;this._closeAllChildWindows().then(function(){$b({requestMsgId:e.id,window:t})}).catch(function(){r._onReady(new bb({isCommandResult:!0,executionError:new Ra}))})},tx.prototype._initChildDriverListening=function(){var n=this;zd.on(zd.SERVICE_MSG_RECEIVED_EVENT,function(e){var t=e.message,r=e.source;t.type===Fb_establishConnection?n._addChildIframeDriverLink(t.id,r):t.type===Fb_setAsMaster?n._handleSetAsMasterMessage(t,r):t.type===Fb_closeAllChildWindows&&n._handleCloseAllWindowsMessage(t,r)})},tx.prototype._getChildIframeDriverLinkByWindow=function(t){return f.arrayUtils.find(this.childIframeDriverLinks,function(e){return e.driverWindow===t})},tx.prototype._getChildWindowDriverLinkByWindow=function(t){return f.arrayUtils.find(this.childWindowDriverLinks,function(e){return e.driverWindow===t})},tx.prototype._runInActiveIframe=function(e){var t=this,r=yd.resolve(),n=this.contextStorage.getItem(Id);!this.activeChildIframeDriverLink&&n&&(r=this._switchToIframe(n,Od)),r.then(function(){return t.contextStorage.setItem(t.EXECUTING_IN_IFRAME_FLAG,!0),t.activeChildIframeDriverLink.executeCommand(e,t.speed)}).then(function(e){return t._onCommandExecutedInIframe(e)}).catch(function(e){return t._onCommandExecutedInIframe(new bb({isCommandResult:!0,executionError:e}))})},tx.prototype._onCommandExecutedInIframe=function(e){this.contextStorage.setItem(this.EXECUTING_IN_IFRAME_FLAG,!1),this._onReady(e)},tx.prototype._ensureChildIframeDriverLink=function(e,t,r){var n=this;return f.waitFor(function(){return n._getChildIframeDriverLinkByWindow(e)},500,r).catch(function(){throw new t})},tx.prototype._ensureChildWindowDriverLink=function(e,t,r){var n=this;return f.waitFor(function(){return n._getChildWindowDriverLinkByWindow(e)},500,r).catch(function(){throw new t})},tx.prototype._switchToIframe=function(t,r){var e,n,i,o,a,s,l,c=this,u="number"==typeof t.timeout?t.timeout:this.selectorTimeout;return e=t,n=u,i=null,o=function(e){return new r.NotFoundError(e)},a=function(){return new r.IsInvisibleError},s=this.statusBar,l=new wc(e,n,i,o,a),s.showWaitingElementStatus(l.timeout),l.getResult().then(function(e){return s.hideWaitingElementStatus(!!e).then(function(){return e})}).catch(function(e){return s.hideWaitingElementStatus(!1).then(function(){throw e})}).then(function(e){if(!f.domUtils.isIframeElement(e))throw new La;return c._ensureChildIframeDriverLink(Bd.contentWindowGetter.call(e),r.NotLoadedError,u)}).then(function(e){e.availabilityTimeout=u,c.activeChildIframeDriverLink=e,c.contextStorage.setItem(Id,t)})},tx.prototype._createWaitForEventPromise=function(t,r){var n=this,i=null,e=new yd(function(e){Bd.setTimeout.call(b,function(){n.off(t,i),e()},r)}),o=new yd(function(e){i=function(){this.off(t,i),e()},n.on(t,i)});return yd.race([e,o])},tx.prototype._waitForCurrentCommandCompletion=function(){return this.contextStorage.getItem(this.COMMAND_EXECUTING_FLAG)?this._createWaitForEventPromise(Rd,Pd):yd.resolve()},tx.prototype._waitForEmptyCommand=function(){return this._createWaitForEventPromise(Sd,3e4)},tx.prototype._abortSwitchingToChildWindowIfItClosed=function(){if(this.activeChildWindowDriverLink.driverWindow.closed)throw f.arrayUtils.remove(this.childWindowDriverLinks,this.activeChildWindowDriverLink),this.activeChildWindowDriverLink=null,new Za},tx.prototype._switchToChildWindow=function(e){var t=this;return this.contextStorage.setItem(this.PENDING_WINDOW_SWITCHING_FLAG,!0),function(t,e){if("string"!=typeof t)return sd.resolve(null);var r=f.arrayUtils.find(e,function(e){return e.windowId===t});if(r)return sd.resolve(r);var n=new Oa;return sd.reject(n)}(e,this.childWindowDriverLinks).then(function(e){return t._ensureChildWindowDriverLink(e.driverWindow,Pa,t.childWindowReadyTimeout)}).then(function(e){return t.activeChildWindowDriverLink=e,t._waitForCurrentCommandCompletion()}).then(function(){return t._waitForEmptyCommand()}).then(function(){return t._abortSwitchingToChildWindowIfItClosed(),t._stopInternal(),t.activeChildWindowDriverLink.setAsMaster()}).then(function(){t.contextStorage.setItem(t.PENDING_WINDOW_SWITCHING_FLAG,!1)}).catch(function(e){t.contextStorage.setItem(t.PENDING_WINDOW_SWITCHING_FLAG,!1),e instanceof Za?t._onReady(new bb):t._onReady(new bb({isCommandResult:!0,executionError:new Qa}))})},tx.prototype._switchToTopParentWindow=function(){var e=this.parentWindowDriverLink.setTopOpenedWindowAsMaster.bind(this.parentWindowDriverLink);this._switchToParentWindowInternal(e)},tx.prototype._switchToParentWindow=function(){var e=this.parentWindowDriverLink.setParentWindowAsMaster.bind(this.parentWindowDriverLink);this._switchToParentWindowInternal(e)},tx.prototype._switchToParentWindowInternal=function(e){var t=this;return this.contextStorage.setItem(this.PENDING_WINDOW_SWITCHING_FLAG,!0),yd.resolve().then(function(){return t._stopInternal(),e()}).then(function(){t.contextStorage.setItem(t.PENDING_WINDOW_SWITCHING_FLAG,!1)}).catch(function(){t.contextStorage.setItem(t.PENDING_WINDOW_SWITCHING_FLAG,!1),t._onReady(new bb({isCommandResult:!0,executionError:new Qa}))})},tx.prototype._switchToMainWindow=function(e){this.activeChildIframeDriverLink&&this.activeChildIframeDriverLink.executeCommand(e),this.contextStorage.setItem(Id,null),this.activeChildIframeDriverLink=null},tx.prototype._setNativeDialogHandlerInIframes=function(e){for(var t=new Lb(e),r=0;r<this.childIframeDriverLinks.length;r++)zd.sendServiceMsg(t,this.childIframeDriverLinks[r].driverWindow)},tx.prototype._onActionCommand=function(e){var t,r,n,i,o=this,a=(t=e,r=this.selectorTimeout,n=this.statusBar,i=this.speed,new Jc(t,r,n,i).execute()),s=a.startPromise,l=a.completionPromise;s.then(function(){return o.contextStorage.setItem(o.COMMAND_EXECUTING_FLAG,!0)}),l.then(function(e){return o.contextStorage.setItem(o.COMMAND_EXECUTING_FLAG,!1),o._onReady(e)})},tx.prototype._onSetNativeDialogHandlerCommand=function(e){this.nativeDialogsTracker.setHandler(e.dialogHandler),this._setNativeDialogHandlerInIframes(e.dialogHandler),this._onReady(new bb({isCommandResult:!0}))},tx.prototype._onGetNativeDialogHistoryCommand=function(){this._onReady(new bb({isCommandResult:!0,result:this.nativeDialogsTracker.appearedDialogs}))},tx.prototype._onGetBrowserConsoleMessagesCommand=function(){this._onReady(new bb({isCommandResult:!0}))},tx.prototype._onNavigateToCommand=function(e){var t,r,n,o=this;this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!0),t=e,r=od.url.getNavigationUrl(t.url,b),n=i.Promise.resolve(),r&&f.browser.isRetryingTestPagesEnabled()&&(n=f.browser.fetchPageToCache(r,nd)),n.then(function(){var e=new f.RequestBarrier;return i.navigateTo(t.url,t.forceReload),i.Promise.all([e.wait(),f.pageUnloadBarrier.wait()])}).then(function(){return new bb({isCommandResult:!0})}).catch(function(e){return new bb({isCommandResult:!0,executionError:e})}).then(function(e){return o.contextStorage.setItem(o.COMMAND_EXECUTING_FLAG,!1),o._onReady(e)})},tx.prototype._onExecuteClientFunctionCommand=function(e){var t=this;this.contextStorage.setItem(Fd,{instantiationCallsiteName:e.instantiationCallsiteName}),new vb(e).getResultDriverStatus().then(function(e){t.contextStorage.setItem(Fd,null),t._onReady(e)})},tx.prototype._onExecuteSelectorCommand=function(e){var t,r,n,i,o,a,s,l=this,c=this.contextStorage.getItem(Gd)||new Cd,u=e.needError?function(e){return new O(null,e)}:null;t=e,r=this.selectorTimeout,n=c,o=i=u,a=this.statusBar,s=new wc(t,r,n,i,o),a.showWaitingElementStatus(s.timeout),s.getResultDriverStatus().then(function(e){return a.hideWaitingElementStatus(!!e.result).then(function(){return e})}).then(function(e){l.contextStorage.setItem(Gd,null),l._onReady(e)})},tx.prototype._onSwitchToMainWindowCommand=function(e){this._switchToMainWindow(e),this._onReady(new bb({isCommandResult:!0}))},tx.prototype._onSwitchToIframeCommand=function(e){var t=this;this._switchToIframe(e.selector,Nd).then(function(){return t._onReady(new bb({isCommandResult:!0}))}).catch(function(e){return t._onReady(new bb({isCommandResult:!0,executionError:e}))})},tx.prototype._onBrowserManipulationCommand=function(e){var t,r,n,i=this;this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!0),t=e,r=this.selectorTimeout,n=this.statusBar,new ld(t,r,n).execute().then(function(e){return i.contextStorage.setItem(i.COMMAND_EXECUTING_FLAG,!1),i._onReady(e)})},tx.prototype._onSetBreakpointCommand=function(e){var t=this;this.statusBar.showDebuggingStatus(e).then(function(e){return t._onReady(new bb({isCommandResult:!0,result:e}))})},tx.prototype._onSetTestSpeedCommand=function(e){this.speed=e.speed,this._onReady(new bb({isCommandResult:!0}))},tx.prototype._onShowAssertionRetriesStatusCommand=function(e){this.contextStorage.setItem(Kd,e.timeout),this.contextStorage.setItem(Ld,Date.now()),this.statusBar.showWaitingAssertionRetriesStatus(e.timeout),this._onReady(new bb({isCommandResult:!0}))},tx.prototype._onHideAssertionRetriesStatusCommand=function(e){var t=this;this.contextStorage.setItem(Kd,null),this.contextStorage.setItem(Ld,null),this.statusBar.hideWaitingAssertionRetriesStatus(e.success).then(function(){return t._onReady(new bb({isCommandResult:!0}))})},tx.prototype._checkStatus=function(){var n=this;return f.browser.checkStatus(this.browserStatusDoneUrl,i.createNativeXHR,{manualRedirect:!0}).then(function(e){var t=e.command,r=e.redirecting;r&&t.url.indexOf(n.testRunId)<0?(Ad.clear(),Ad.lock()):n.contextStorage.setItem(Dd,!1),r?f.browser.redirect(t):n._onReady({isCommandResult:!1})}).catch(function(){return f.delay(1e3)})},tx.prototype._onCustomCommand=function(e){var t=this;(0,this.customCommandHandlers[e.type].handler)(e).then(function(e){t._onReady(new bb({isCommandResult:!0,result:e}))})},tx.prototype._closeAllChildWindows=function(){var e=this;return this.childWindowDriverLinks.length?yd.all(this.childWindowDriverLinks.map(function(e){return e.closeAllChildWindows()})).then(function(){Bd.arrayForEach.call(e.childWindowDriverLinks,function(e){e.driverWindow.close()})}):yd.resolve()},tx.prototype._onTestDone=function(e){var t=this;this.contextStorage.setItem(Dd,!0),this.parentWindowDriverLink?this._switchToTopParentWindow():this._closeAllChildWindows().then(function(){return t._sendStatus(e)}).then(function(){t._checkStatus()}).catch(function(){t._onReady(new bb({isCommandResult:!0,executionError:Ra}))})},tx.prototype._onBackupStoragesCommand=function(){this._onReady(new bb({isCommandResult:!0,result:Ad.backup()}))},tx.prototype._isStatusWithCommandResultInPendingWindowSwitchingMode=function(e){return e.isCommandResult&&!!this.contextStorage.getItem(this.PENDING_WINDOW_SWITCHING_FLAG)},tx.prototype._isEmptyCommandInPendingWindowSwitchingMode=function(e){return!e&&!!this.contextStorage.getItem(this.PENDING_WINDOW_SWITCHING_FLAG)},tx.prototype._onReady=function(e){var t=this;this._isStatusWithCommandResultInPendingWindowSwitchingMode(e)&&this.emit(Rd),this._sendStatus(e).then(function(e){if(e)t._onCommand(e);else{if(t._isEmptyCommandInPendingWindowSwitchingMode(e))return void t.emit(Sd);t._onReady(new bb)}})},tx.prototype._executeCommand=function(e){this.customCommandHandlers[e.type]?this._onCustomCommand(e):e.type===v.testDone?this._onTestDone(new bb({isCommandResult:!0})):e.type===v.setBreakpoint?this._onSetBreakpointCommand(e.isTestError):e.type===v.switchToMainWindow?this._onSwitchToMainWindowCommand(e):e.type===v.switchToIframe?this._onSwitchToIframeCommand(e):C(e)?this._onBrowserManipulationCommand(e):e.type===v.executeClientFunction?this._onExecuteClientFunctionCommand(e):e.type===v.executeSelector?this._onExecuteSelectorCommand(e):e.type===v.navigateTo?this._onNavigateToCommand(e):e.type===v.setNativeDialogHandler?this._onSetNativeDialogHandlerCommand(e):e.type===v.getNativeDialogHistory?this._onGetNativeDialogHistoryCommand(e):e.type===v.getBrowserConsoleMessages?this._onGetBrowserConsoleMessagesCommand(e):e.type===v.setTestSpeed?this._onSetTestSpeedCommand(e):e.type===v.showAssertionRetriesStatus?this._onShowAssertionRetriesStatusCommand(e):e.type===v.hideAssertionRetriesStatus?this._onHideAssertionRetriesStatusCommand(e):e.type===v.backupStorages?this._onBackupStoragesCommand():this._onActionCommand(e)},tx.prototype._isExecutableInTopWindowOnly=function(e){if((t=e).type===v.testDone||t.type===v.switchToMainWindow||t.type===v.setNativeDialogHandler||t.type===v.getNativeDialogHistory||t.type===v.setTestSpeed||t.type===v.showAssertionRetriesStatus||t.type===v.hideAssertionRetriesStatus||t.type===v.setBreakpoint||C(t)&&t.type!==v.takeElementScreenshot)return!0;var t,r=this.customCommandHandlers[e.type];return e.forceExecutionInTopWindowOnly||r&&r.isExecutableInTopWindowOnly},tx.prototype._onCommand=function(r){var n=this;this.readyPromise.then(function(){var e=w(r);if(n.contextStorage.getItem(Hd)&&e)n._onReady(new bb({isCommandResult:!0}));else{var t=n.activeChildIframeDriverLink||n.contextStorage.getItem(Id);n._isExecutableInTopWindowOnly(r)||!t?n._executeCommand(r):n._runInActiveIframe(r)}})},tx.prototype.setCustomCommandHandlers=function(e,t,r){this.customCommandHandlers[e]={isExecutableInTopWindowOnly:r,handler:t}},tx.prototype._startInternal=function(e){this.role=wd_master,f.browser.startHeartbeat(this.heartbeatUrl,i.createNativeXHR),this._setupAssertionRetryIndication(),this._startCommandsProcessing(e)},tx.prototype._stopInternal=function(){this.role=wd_replica,f.browser.stopHeartbeat(),g.cursor.hide()},tx.prototype._setupAssertionRetryIndication=function(){var r=this;this.readyPromise.then(function(){r.statusBar.hidePageLoadingStatus();var e=r.contextStorage.getItem(Kd);if(e){var t=r.contextStorage.getItem(Ld);0<e-(new Date-t)&&r.statusBar.showWaitingAssertionRetriesStatus(e,t)}})},tx.prototype._startCommandsProcessing=function(e){void 0===e&&(e={finalizePendingCommand:!1,isFirstRequestAfterWindowSwitching:!1});var t=this.contextStorage.getItem(Ed);if(t&&(t.resent=!0),this.contextStorage.getItem(Dd))t?this._onTestDone(t):this._checkStatus();else if(!this._failIfClientCodeExecutionIsInterrupted()){var r=e.finalizePendingCommand||this._hasPendingActionFlags(this.contextStorage),n=t||new bb({isCommandResult:r,isFirstRequestAfterWindowSwitching:e.isFirstRequestAfterWindowSwitching});this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!1),this.contextStorage.setItem(this.EXECUTING_IN_IFRAME_FLAG,!1),this.contextStorage.setItem(this.PENDING_WINDOW_SWITCHING_FLAG,!1),this._onReady(n)}},tx.prototype._initParentWindowLink=function(){b.opener&&(this.parentWindowDriverLink=new vd(b))},tx.prototype._initConsoleMessages=function(){var e=this.consoleMessages;e.ensureMessageContainer(this.windowId),this.consoleMessages=e},tx.prototype._getDriverRole=function(){var t=this;return this.windowId?f.browser.getActiveWindowId(this.browserActiveWindowId,i.createNativeXHR).then(function(e){return e.activeWindowId===t.windowId?wd_master:wd_replica}):yd.resolve(wd_master)},tx.prototype._init=function(){this.contextStorage=new Rb(b,this.testRunId,this.windowId),this.nativeDialogsTracker=new Eb(this.contextStorage,this.dialogHandler),this.statusBar=new h.StatusBar(this.userAgent,this.fixtureName,this.testName,this.contextStorage),this.statusBar.on(this.statusBar.UNLOCK_PAGE_BTN_CLICK,f.disableRealEventsPreventing),this.speed=this.initialSpeed,this._initConsoleMessages()},tx.prototype.start=function(){var t=this;this._init(),this._getDriverRole().then(function(e){e===wd_master?t._startInternal():t._initParentWindowLink()})},tx);function tx(e,t,r,n){var o=sx.call(this)||this;return o.COMMAND_EXECUTING_FLAG="testcafe|driver|command-executing-flag",o.EXECUTING_IN_IFRAME_FLAG="testcafe|driver|executing-in-iframe-flag",o.PENDING_WINDOW_SWITCHING_FLAG="testcafe|driver|pending-window-switching-flag",o.testRunId=e,o.heartbeatUrl=t.heartbeat,o.browserStatusUrl=t.status,o.browserStatusDoneUrl=t.statusDone,o.browserActiveWindowId=t.activeWindowId,o.userAgent=r.userAgent,o.fixtureName=r.fixtureName,o.testName=r.testName,o.selectorTimeout=n.selectorTimeout,o.pageLoadTimeout=n.pageLoadTimeout,o.childWindowReadyTimeout=n.childWindowReadyTimeout,o.initialSpeed=n.speed,o.skipJsErrors=n.skipJsErrors,o.dialogHandler=n.dialogHandler,o.customCommandHandlers={},o.contextStorage=null,o.nativeDialogsTracker=null,o.childIframeDriverLinks=[],o.activeChildIframeDriverLink=null,o.childWindowDriverLinks=[],o.parentWindowDriverLink=null,o.statusBar=null,o.windowId=o._getCurrentWindowId(),o.role=wd_replica,o.setAsMasterInProgress=!1,o.checkClosedChildWindowIntervalId=null,n.retryTestPages&&f.browser.enableRetryingTestPages(),o.pageInitialRequestBarrier=new f.RequestBarrier,o.readyPromise=f.eventUtils.documentReady(o.pageLoadTimeout).then(function(){return o.pageInitialRequestBarrier.wait(!0)}),o._initChildDriverListening(),f.pageUnloadBarrier.init(),f.preventRealEvents(),i.on(i.EVENTS.uncaughtJsError,function(e){return o._onJsError(e)}),i.on(i.EVENTS.unhandledRejection,function(e){return o._onJsError(e)}),i.on(i.EVENTS.consoleMethCalled,function(e){return o._onConsoleMessage(e)}),i.on(i.EVENTS.beforeFormSubmit,function(e){return o._onFormSubmit(e)}),i.on(i.EVENTS.windowOpened,function(e){return o._onChildWindowOpened(e)}),o.setCustomCommandHandlers(v.unlockPage,function(){return o._unlockPageAfterTestIsDone()}),o}var Ud=(XA.prototype.establishConnection=function(){return Ub(new Hb,this.driverWindow,5e3,Na).then(function(e){return e.result.id})},XA.prototype.sendConfirmationMessage=function(e){$b({requestMsgId:e,window:this.driverWindow})},XA.prototype.onCommandExecuted=function(t){var r=new Ib(t);e.eventSandbox.message.sendServiceMsg(r,this.driverWindow)},XA);function XA(e){this.driverWindow=e}var cB,Vd=i.eventSandbox.message,Wd=(l(dB,cB=Eb),dB.prototype._defaultDialogHandler=function(e){Vd.sendServiceMsg({type:wb_unexpectedDialog,dialogType:e,url:Eb._getPageUrl()},b.top)},dB.prototype._addAppearedDialogs=function(e,t){Vd.sendServiceMsg({type:wb_appearedDialog,dialogType:e,text:t,url:Eb._getPageUrl()},b.top)},dB.prototype._onHandlerError=function(e,t){Vd.sendServiceMsg({type:wb_handlerError,dialogType:e,message:t,url:Eb._getPageUrl()},b.top)},dB);function dB(e){return cB.call(this,null,e)||this}var kB,Xd=(l(lB,kB=Td),lB.prototype._onJsError=function(){},lB.prototype._onConsoleMessage=function(){},lB.prototype._initParentDriverListening=function(){var r=this;e.eventSandbox.message.on(e.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,function(e){var t=e.message;f.pageUnloadBarrier.wait(0).then(function(){if(t.type===Fb_executeCommand){if(r.lastParentDriverMessageId===t.id)return;r.lastParentDriverMessageId=t.id,r.readyPromise.then(function(){r.speed=t.testSpeed,r.parentDriverLink.sendConfirmationMessage(t.id),r._onCommand(t.command)})}t.type===Fb_setNativeDialogHandler&&(r.nativeDialogsTracker.setHandler(t.dialogHandler),r._setNativeDialogHandlerInIframes(t.dialogHandler))})})},lB.prototype._onSwitchToMainWindowCommand=function(e){this._switchToMainWindow(e)},lB.prototype._onReady=function(e){this.parentDriverLink.onCommandExecuted(e)},lB.prototype.start=function(){var t=this;this.nativeDialogsTracker=new Wd(this.dialogHandler),this.statusBar=new h.IframeStatusBar;var r=this.parentDriverLink.establishConnection().then(function(e){t.contextStorage=new Rb(b,e,t.windowId),t._failIfClientCodeExecutionIsInterrupted()||(t.contextStorage.getItem(t.COMMAND_EXECUTING_FLAG)||t.contextStorage.getItem(t.EXECUTING_IN_IFRAME_FLAG))&&(t.contextStorage.setItem(t.COMMAND_EXECUTING_FLAG,!1),t.contextStorage.setItem(t.EXECUTING_IN_IFRAME_FLAG,!1),t._onReady(new bb({isCommandResult:!0})))});this.readyPromise=e.Promise.all([this.readyPromise,r])},lB);function lB(e,t){var r=kB.call(this,e,{},{},t)||this;return r.lastParentDriverMessageId=null,r.parentDriverLink=new Ud(b.parent),r._initParentDriverListening(),r}var Yd={NodeSnapshot:kb,ElementSnapshot:nb,SelectorExecutor:wc},Zd_testCafeDriver="%testCafeDriver%",Zd_testCafeIframeDriver="%testCafeIframeDriver%",Zd_scriptExecutionBarrier="%ScriptExecutionBarrier%",Zd_testCafeEmbeddingUtils="%testCafeEmbeddingUtils%",$d=i.nativeMethods,_d=i.EVENTS.evalIframeScript;$d.objectDefineProperty(b,Zd_testCafeDriver,{configurable:!0,value:Td}),$d.objectDefineProperty(b,Zd_testCafeIframeDriver,{configurable:!0,value:Xd}),$d.objectDefineProperty(b,Zd_scriptExecutionBarrier,{configurable:!0,value:dc}),$d.objectDefineProperty(b,Zd_testCafeEmbeddingUtils,{configurable:!0,value:Yd}),i.on(_d,function(e){return a($d.contentWindowGetter.call(e.iframe))})}(b["%hammerhead%"],b["%testCafeCore%"],b["%testCafeAutomation%"],b["%testCafeUI%"])}(window);